                    </div>

                    <button id="saveSettingsBtn" class="btn-primary text-white px-6 py-3 rounded-lg font-semibold">
                        Save Settings | 保存设置
                    </button>

                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h4 class="font-medium text-blue-900 mb-2">📊 Data Statistics | 数据统计</h4>
                        <div id="statsGrid" class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                            <!-- 统计数据 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 修改时间弹窗 -->
    <div id="modifyModal" style="display: none;" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="glass-effect rounded-2xl p-6 max-w-md w-full mx-4">
            <h3 class="text-xl font-bold mb-4 gradient-text">Modify Appointment Time | 修改预约时间</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        New Date | 新日期 <span class="text-red-500">*</span>
                    </label>
                    <input type="date" id="newDate" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        New Time Slot | 新时间段 <span class="text-red-500">*</span>
                    </label>
                    <select id="newTimeSlot" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="10:00-11:30">10:00-11:30</option>
                        <option value="11:30-13:00">11:30-13:00</option>
                        <option value="13:00-14:30">13:00-14:30</option>
                    </select>
                </div>
            </div>
            
            <div class="flex space-x-3 mt-6">
                <button id="cancelModify" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                    Cancel | 取消
                </button>
                <button id="confirmModify" class="flex-1 btn-primary text-white px-4 py-2 rounded-lg">
                    Confirm | 确认
                </button>
            </div>
        </div>
    </div>

    <script>
        // 应用数据
        const appData = {
            bookings: [],
            settings: {
                welcomeMessage: 'Welcome to our property inspection booking system! We provide professional and caring property inspection services.',
                noticeMessage: 'Please note:\n• Please ensure the appointment time is accurate\n• For cancellations or modifications, please contact us 24 hours in advance\n• Please prepare relevant documents on the inspection day\n• If you have special requirements, please specify in the remarks\n\n请注意：\n• 请确保预约时间准确无误\n• 如需取消或修改，请提前24小时联系\n• 检查当天请准备好相关文件\n• 如有特殊要求，请在备注中说明',
                afterSubmitNotice: 'We will confirm your appointment details within 24 hours.\nIf you have any questions, please contact us anytime.\nThank you for your trust!\n\n我们会在24小时内与您确认预约详情。\n如有任何疑问，请随时联系我们。\n谢谢您的信任！'
            },
            nextOrderNumber: 1,
            selectedDate: '',
            selectedTimeSlot: '',
            currentCalendarDate: new Date(),
            selectedCalendarDate: null,
            showAllOrders: true,
            currentModifyingBookingId: null,
            lastCloudSync: null,
            autoRefreshInterval: null
        };

        // 🌐 云端数据存储函数
        async function saveToCloud() {
            try {
                console.log('🌐 正在保存到云端数据库...');
                const response = await fetch('/api/bookings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        bookings: appData.bookings,
                        settings: appData.settings,
                        nextOrderNumber: appData.nextOrderNumber
                    })
                });

                const result = await response.json();
                
                if (response.ok) {
                    console.log('✅ 云端保存成功!', result);
                    appData.lastCloudSync = new Date();
                    return true;
                } else {
                    console.error('❌ 云端保存失败:', result);
                    return false;
                }
            } catch (error) {
                console.error('❌ 云端保存错误:', error);
                return false;
            }
        }

        // 📂 云端数据加载函数
        async function loadFromCloud() {
            try {
                console.log('🌐 正在从云端数据库加载...');
                const response = await fetch('/api/bookings');
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('📦 收到云端数据:', data);
                    
                    if (data.success) {
                        appData.bookings = data.bookings || [];
                        appData.settings = { ...appData.settings, ...data.settings };
                        appData.nextOrderNumber = data.nextOrderNumber || 1;
                        appData.lastCloudSync = new Date();
                        
                        console.log(`✅ 成功加载 ${appData.bookings.length} 个订单`);
                        return true;
                    }
                } else {
                    console.error('❌ 云端加载失败:', response.status);
                    return false;
                }
            } catch (error) {
                console.error('❌ 云端加载错误:', error);
                return false;
            }
        }

        // 💾 智能数据保存函数
        async function saveData() {
            try {
                const dataToSave = {
                    bookings: appData.bookings,
                    nextOrderNumber: appData.nextOrderNumber,
                    settings: appData.settings,
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem('propertyBookingData', JSON.stringify(dataToSave));
                console.log('💾 本地备份已保存');
            } catch (error) {
                console.error('❌ 本地备份失败:', error);
            }
            
            const cloudSuccess = await saveToCloud();
            
            if (cloudSuccess) {
                console.log('🎉 数据已成功保存到云端并本地备份');
            } else {
                console.log('⚠️ 云端保存失败，但本地备份已保存');
            }
        }

        // 🔄 智能数据加载函数
        async function loadData() {
            console.log('🔄 开始加载数据...');
            
            const cloudSuccess = await loadFromCloud();
            
            if (!cloudSuccess) {
                console.log('⚠️ 云端加载失败，尝试本地备份...');
                try {
                    const saved = localStorage.getItem('propertyBookingData');
                    if (saved) {
                        const data = JSON.parse(saved);
                        appData.bookings = data.bookings || [];
                        appData.nextOrderNumber = data.nextOrderNumber || 1;
                        if (data.settings) {
                            appData.settings = { ...appData.settings, ...data.settings };
                        }
                        console.log('💾 本地备份数据已加载');
                    }
                } catch (error) {
                    console.error('❌ 本地备份加载失败:', error);
                }
            }
            
            if (document.getElementById('welcomeText')) {
                document.getElementById('welcomeText').textContent = appData.settings.welcomeMessage;
            }
            
            console.log('✅ 数据加载完成');
        }

        // 🔄 自动刷新
        function startAutoRefresh() {
            if (appData.autoRefreshInterval) {
                clearInterval(appData.autoRefreshInterval);
            }
            
            appData.autoRefreshInterval = setInterval(async () => {
                if (document.getElementById('adminView').style.display !== 'none') {
                    console.log('🔄 自动刷新数据...');
                    await loadFromCloud();
                    loadOrdersList();
                    generateCalendar();
                    updateStats();
                }
            }, 30000);
        }

        function stopAutoRefresh() {
            if (appData.autoRefreshInterval) {
                clearInterval(appData.autoRefreshInterval);
                appData.autoRefreshInterval = null;
            }
        }

        // 视图切换
        function showCustomerView() {
            document.getElementById('customerView').style.display = 'block';
            document.getElementById('adminView').style.display = 'none';
            document.getElementById('customerTab').className = 'nav-active px-4 py-2 rounded-lg font-semibold transition-all';
            document.getElementById('adminTab').className = 'nav-inactive px-4 py-2 rounded-lg font-semibold transition-all';
            stopAutoRefresh();
        }

        async function showAdminView() {
            const password = prompt('Please enter admin password | 请输入管理员密码:');
            if (password === 'admin123') {
                document.getElementById('customerView').style.display = 'none';
                document.getElementById('adminView').style.display = 'block';
                document.getElementById('adminTab').className = 'nav-active px-4 py-2 rounded-lg font-semibold transition-all';
                document.getElementById('customerTab').className = 'nav-inactive px-4 py-2 rounded-lg font-semibold transition-all';
                
                await loadFromCloud();
                generateCalendar();
                showOrdersTab();
                startAutoRefresh();
            } else if (password !== null) {
                alert('Incorrect password! | 密码错误！');
            }
        }

        // 步骤控制
        function showStep(stepNumber) {
            document.getElementById('step1').style.display = stepNumber === 1 ? 'block' : 'none';
            document.getElementById('step2').style.display = stepNumber === 2 ? 'block' : 'none';
            document.getElementById('step3').style.display = stepNumber === 3 ? 'block' : 'none';
        }

        // 验证第一步
        function validateStep1() {
            const required = ['customerName', 'phone', 'email', 'address', 'serviceType', 'keyArrangement'];
            for (const field of required) {
                if (!document.getElementById(field).value.trim()) {
                    alert('Please fill in all required fields! | 请填写所有必填字段！');
                    return false;
                }
            }
            
            if (document.getElementById('keyArrangement').value === 'Other | 其他') {
                if (!document.getElementById('keyOtherDetails').value.trim()) {
                    alert('Please specify the key arrangement details! | 请详细说明钥匙的具体安排！');
                    return false;
                }
            }
            
            return true;
        }

        // 生成可用日期
        function generateAvailableDates() {
            const dates = [];
            const today = new Date();
            
            for (let i = 1; i <= 30; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                
                if (date.getDay() >= 1 && date.getDay() <= 5) {
                    dates.push(date.toISOString().split('T')[0]);
                }
            }
            return dates;
        }

        // 检查时间段是否被预约
        function isTimeSlotBooked(date, timeSlot) {
            return appData.bookings.some(booking => 
                booking.preferredDate === date && 
                booking.preferredTimeSlot === timeSlot &&
                booking.status === 'confirmed'
            );
        }

        // 生成日期网格
        async function generateDateGrid() {
            await loadFromCloud();
            
            const dates = generateAvailableDates();
            const dateGrid = document.getElementById('dateGrid');
            dateGrid.innerHTML = '';

            dates.slice(0, 12).forEach(date => {
                const timeSlots = ['10:00-11:30', '11:30-13:00', '13:00-14:30'];
                const hasAvailableSlots = timeSlots.some(slot => !isTimeSlotBooked(date, slot));
                
                if (hasAvailableSlots) {
                    const dateObj = new Date(date);
                    const button = document.createElement('button');
                    button.type = 'button';
                    button.className = 'p-3 rounded-lg border-2 transition-all hover:scale-105 border-gray-200 hover:border-blue-300 hover:bg-blue-50 bg-white';
                    
                    button.addEventListener('click', function() {
                        selectDate(date, this);
                    });
                    
                    button.innerHTML = `
                        <div class="text-sm font-medium">
                            ${dateObj.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' })}
                        </div>
                        <div class="text-xs text-gray-500">
                            ${dateObj.toLocaleDateString('zh-CN', { weekday: 'short' })}
                        </div>
                    `;
                    dateGrid.appendChild(button);
                }
            });
        }

        // 选择日期
        function selectDate(date, button) {
            document.querySelectorAll('#dateGrid button').forEach(btn => {
                btn.className = 'p-3 rounded-lg border-2 transition-all hover:scale-105 border-gray-200 hover:border-blue-300 hover:bg-blue-50 bg-white';
            });

            button.className = 'p-3 rounded-lg border-2 transition-all hover:scale-105 border-orange-500 bg-orange-50 text-orange-700';
            appData.selectedDate = date;
            appData.selectedTimeSlot = '';
            
            generateTimeSlotGrid();
            document.getElementById('timeSlotSection').style.display = 'block';
            updateSubmitButton();
        }

        // 生成时间段网格
        function generateTimeSlotGrid() {
            const timeSlots = ['10:00-11:30', '11:30-13:00', '13:00-14:30'];
            const timeSlotGrid = document.getElementById('timeSlotGrid');
            timeSlotGrid.innerHTML = '';

            timeSlots.forEach(timeSlot => {
                const isBooked = isTimeSlotBooked(appData.selectedDate, timeSlot);
                const button = document.createElement('button');
                button.type = 'button';
                
                if (isBooked) {
                    button.className = 'time-slot-booked p-4 rounded-lg font-medium transition-all';
                    button.disabled = true;
                    button.innerHTML = `
                        <div class="text-lg">${timeSlot}</div>
                        <div class="text-sm mt-1">已预约 | Booked</div>
                    `;
                } else {
                    button.className = 'time-slot-available p-4 rounded-lg font-medium transition-all';
                    button.addEventListener('click', function() {
                        selectTimeSlot(timeSlot, this);
                    });
                    button.innerHTML = `
                        <div class="text-lg">${timeSlot}</div>
                        <div class="text-sm mt-1">可预约 | Available</div>
                    `;
                }
                
                timeSlotGrid.appendChild(button);
            });
        }

        // 选择时间段
        function selectTimeSlot(timeSlot, button) {
            document.querySelectorAll('#timeSlotGrid button:not(:disabled)').forEach(btn => {
                btn.className = 'time-slot-available p-4 rounded-lg font-medium transition-all';
                btn.innerHTML = btn.innerHTML.replace('已选择 | Selected', '可预约 | Available');
            });

            button.className = 'time-slot-selected p-4 rounded-lg font-medium transition-all';
            button.innerHTML = `
                <div class="text-lg">${timeSlot}</div>
                <div class="text-sm mt-1">已选择 | Selected</div>
            `;
            
            appData.selectedTimeSlot = timeSlot;
            updateSubmitButton();
        }

        // 更新提交按钮
        function updateSubmitButton() {
            const submitBtn = document.getElementById('submitBtn');
            if (appData.selectedDate && appData.selectedTimeSlot) {
                submitBtn.disabled = false;
                submitBtn.className = 'btn-primary text-white px-6 sm:px-8 py-3 rounded-lg font-semibold';
            } else {
                submitBtn.disabled = true;
                submitBtn.className = 'btn-primary text-white px-6 sm:px-8 py-3 rounded-lg font-semibold opacity-50 cursor-not-allowed';
            }
        }

        // 提交预约
        async function submitBooking() {
            const orderNum = appData.nextOrderNumber.toString().padStart(3, '0');
            const newOrderNumber = `INV-JOYA-${orderNum}`;
            appData.nextOrderNumber++;

            let keyArrangement = document.getElementById('keyArrangement').value;
            if (keyArrangement === 'Other | 其他') {
                keyArrangement = 'Other | 其他：' + document.getElementById('keyOtherDetails').value;
            }

            const newBooking = {
                id: Date.now(),
                orderNumber: newOrderNumber,
                customerName: document.getElementById('customerName').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                address: document.getElementById('address').value,
                postcode: document.getElementById('postcode').value,
                serviceType: document.getElementById('serviceType').value,
                preferredDate: appData.selectedDate,
                preferredTimeSlot: appData.selectedTimeSlot,
                keyArrangement: keyArrangement,
                specialRequirements: document.getElementById('specialRequirements').value,
                notes: document.getElementById('notes').value,
                status: 'pending',
                createdAt: new Date().toISOString()
            };

            appData.bookings.push(newBooking);
            await saveData();
            
            document.getElementById('orderNumber').textContent = newOrderNumber;
            document.getElementById('bookingDetails').innerHTML = `
                <p><strong>Name | 姓名：</strong>${newBooking.customerName}</p>
                <p><strong>Phone | 联系方式：</strong>${newBooking.phone}</p>
                <p><strong>Service Type | 服务类型：</strong>${newBooking.serviceType}</p>
                <p><strong>Date | 预约日期：</strong>${newBooking.preferredDate}</p>
                <p><strong>Time | 预约时间：</strong>${newBooking.preferredTimeSlot}</p>
                <p><strong>Key Arrangement | 钥匙安排：</strong>${newBooking.keyArrangement}</p>
            `;
            
            showStep(3);
        }

        // 重置表单
        function resetForm() {
            const fields = ['customerName', 'phone', 'email', 'address', 'postcode', 'specialRequirements', 'notes', 'keyOtherDetails'];
            fields.forEach(field => {
                if (document.getElementById(field)) {
                    document.getElementById(field).value = '';
                }
            });
            
            document.getElementById('serviceType').selectedIndex = 0;
            document.getElementById('keyArrangement').selectedIndex = 0;
            document.getElementById('keyOtherSection').style.display = 'none';
            
            appData.selectedDate = '';
            appData.selectedTimeSlot = '';
            document.getElementById('timeSlotSection').style.display = 'none';
            
            showStep(1);
        }

        // 确认预约
        async function confirmBooking(bookingId) {
            const booking = appData.bookings.find(b => b.id === bookingId);
            if (booking) {
                console.log('🔄 正在确认订单:', booking.orderNumber);
                booking.status = 'confirmed';
                booking.confirmedDate = booking.preferredDate;
                booking.confirmedTimeSlot = booking.preferredTimeSlot;
                await saveData();
                loadOrdersList();
                generateCalendar();
                console.log('✅ 订单确认完成，已同步到云端');
                await sendConfirmationEmail(booking, false);
            }
        }

        // 取消预约
        async function cancelBooking(bookingId) {
            if (confirm('Are you sure you want to cancel this booking? | 确定要取消这个预约吗？')) {
                const booking = appData.bookings.find(b => b.id === bookingId);
                if (booking) {
                    console.log('🔄 正在取消订单:', booking.orderNumber);
                    booking.status = 'cancelled';
                    await saveData();
                    loadOrdersList();
                    generateCalendar();
                    console.log('✅ 订单取消完成，已同步到云端');
                    await sendCancellationEmail(booking);
                }
            }
        }

        // 删除预约
        async function deleteBooking(bookingId) {
            if (confirm('Are you sure you want to delete this booking? This action cannot be undone. | 确定要删除这个预约吗？此操作无法撤销。')) {
                const bookingIndex = appData.bookings.findIndex(b => b.id === bookingId);
                if (bookingIndex !== -1) {
                    const booking = appData.bookings[bookingIndex];
                    console.log('🔄 正在删除订单:', booking.orderNumber);
                    appData.bookings.splice(bookingIndex, 1);
                    await saveData();
                    loadOrdersList();
                    generateCalendar();
                    console.log('✅ 订单删除完成，已同步到云端');
                    alert('Booking deleted successfully. | 预约已成功删除。');
                }
            }
        }

        // 发送确认邮件
        async function sendConfirmationEmail(booking, isModification = false) {
            const subject = isModification ? 
                `Booking Time Modified | 预约时间已修改 - ${booking.orderNumber}` : 
                `Booking Confirmed | 预约已确认 - ${booking.orderNumber}`;

            console.log('🚀 开始发送邮件...', { to: booking.email, subject: subject });

            try {
                const response = await fetch('/api/send-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        to: booking.email,
                        subject: subject,
                        bookingData: {
                            type: 'confirmation',
                            booking: booking,
                            isModification: isModification
                        }
                    })
                });

                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    const result = await response.json();
                    if (response.ok && result.success) {
                        alert(`✅ ${isModification ? 'Modification notification' : 'Confirmation'} email sent successfully!`);
                    } else {
                        throw new Error(`API Error: ${result.error || 'Unknown error'}`);
                    }
                } else {
                    const text = await response.text();
                    console.error('❌ 非JSON响应:', text.substring(0, 200));
                    throw new Error(`API返回非JSON响应 (状态: ${response.status})`);
                }
            } catch (error) {
                console.error('❌ 邮件发送失败:', error);
                alert(`❌ Failed to send email: ${error.message}\n\nThe booking is still saved successfully.`);
            }
        }

        // 发送取消邮件
        async function sendCancellationEmail(booking) {
            try {
                const response = await fetch('/api/send-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        to: booking.email,
                        subject: `Booking Cancelled | 预约已取消 - ${booking.orderNumber}`,
                        bookingData: {
                            type: 'cancellation',
                            booking: booking,
                            isModification: false
                        }
                    })
                });

                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    const result = await response.json();
                    if (response.ok && result.success) {
                        alert(`✅ Cancellation email sent successfully!`);
                    } else {
                        throw new Error(result.error || 'Failed to send email');
                    }
                } else {
                    throw new Error(`API返回非JSON响应`);
                }
            } catch (error) {
                console.error('❌ 取消邮件发送失败:', error);
                alert(`❌ Failed to send cancellation email: ${error.message}\n\nThe booking cancellation is still saved.`);
            }
        }

        // 生成日历
        function generateCalendar() {
            const year = appData.currentCalendarDate.getFullYear();
            const month = appData.currentCalendarDate.getMonth();
            
            document.getElementById('currentMonthYear').textContent = 
                `${year}年${month + 1}月 | ${year}-${(month + 1).toString().padStart(2, '0')}`;
            
            const firstDay = new Date(year, month, 1);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';
            
            const weekDays = ['Sun | 日', 'Mon | 一', 'Tue | 二', 'Wed | 三', 'Thu | 四', 'Fri | 五', 'Sat | 六'];
            weekDays.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'text-center font-semibold text-gray-600 p-2 text-xs';
                dayHeader.textContent = day;
                calendarGrid.appendChild(dayHeader);
            });
            
            for (let i = 0; i < 42; i++) {
                const currentDate = new Date(startDate);
                currentDate.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                const dateString = currentDate.toISOString().split('T')[0];
                
                dayElement.className = 'relative p-2 text-center border border-gray-100 rounded min-h-[60px] flex flex-col justify-center cursor-pointer transition-all hover:bg-gray-50';
                dayElement.setAttribute('data-date', dateString);
                
                const isCurrentMonth = currentDate.getMonth() === month;
                const hasBookings = appData.bookings.some(booking => 
                    booking.preferredDate === dateString && booking.status === 'confirmed'
                );
                
                const isSelected = appData.selectedCalendarDate === dateString;
                
                if (isCurrentMonth) {
                    if (isSelected) {
                        dayElement.className += ' calendar-day-selected bg-orange-200 border-orange-400 text-gray-900';
                    } else {
                        dayElement.className += ' bg-white text-gray-900';
                        if (hasBookings) {
                            dayElement.className += ' bg-blue-100 border-blue-300';
                        }
                    }
                    dayElement.addEventListener('click', () => handleCalendarDayClick(dateString));
                } else {
                    dayElement.className += ' bg-gray-50 text-gray-400 cursor-default';
                }
                
                dayElement.innerHTML = `
                    <div class="text-sm font-medium">${currentDate.getDate()}</div>
                    ${hasBookings ? '<div class="w-2 h-2 bg-blue-500 rounded-full mx-auto mt-1"></div>' : ''}
                `;
                
                calendarGrid.appendChild(dayElement);
            }
        }

        // 日历点击处理
        function handleCalendarDayClick(dateString) {
            const showAllBtn = document.getElementById('showAllOrdersBtn');
            
            if (appData.selectedCalendarDate === dateString) {
                appData.selectedCalendarDate = null;
                appData.showAllOrders = true;
                showAllBtn.style.display = 'none';
                generateCalendar();
            } else {
                appData.selectedCalendarDate = dateString;
                appData.showAllOrders = false;
                showAllBtn.style.display = 'block';
                generateCalendar();
            }
            
            loadOrdersList();
        }

        // 管理员标签页切换
        function showOrdersTab() {
            document.getElementById('ordersTab').style.display = 'block';
            document.getElementById('settingsTab').style.display = 'none';
            document.getElementById('ordersTabBtn').className = 'flex-1 py-3 px-4 rounded-md font-medium transition-all nav-active';
            document.getElementById('settingsTabBtn').className = 'flex-1 py-3 px-4 rounded-md font-medium transition-all nav-inactive';
            loadOrdersList();
        }

        function showSettingsTab() {
            document.getElementById('ordersTab').style.display = 'none';
            document.getElementById('settingsTab').style.display = 'block';
            document.getElementById('ordersTabBtn').className = 'flex-1 py-3 px-4 rounded-md font-medium transition-all nav-inactive';
            document.getElementById('settingsTabBtn').className = 'flex-1 py-3 px-4 rounded-md font-medium transition-all nav-active';
            
            document.getElementById('welcomeMessageInput').value = appData.settings.welcomeMessage;
            document.getElementById('noticeMessageInput').value = appData.settings.noticeMessage;
            document.getElementById('afterSubmitNoticeInput').value = appData.settings.afterSubmitNotice;
            updateStats();
        }

        // 加载订单列表
        function loadOrdersList() {
            const ordersList = document.getElementById('ordersList');
            
            let filteredBookings = appData.bookings;
            if (!appData.showAllOrders && appData.selectedCalendarDate) {
                filteredBookings = appData.bookings.filter(booking => 
                    booking.preferredDate === appData.selectedCalendarDate
                );
            }
            
            if (filteredBookings.length === 0) {
                const message = appData.showAllOrders ? 
                    'No orders found | 暂无订单' : 
                    'No orders for selected date | 所选日期无订单';
                ordersList.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-4xl mb-4">📋</div>
                        <p class="text-gray-500">${message}</p>
                    </div>
                `;
                return;
            }

            ordersList.innerHTML = filteredBookings.slice().reverse().map(booking => `
                <div class="admin-bg rounded-lg p-4 mb-4 card-hover border border-gray-200">
                    <div class="flex flex-col sm:flex-row justify-between items-start mb-3">
                        <div>
                            <h4 class="font-bold text-lg text-blue-900">${booking.orderNumber}</h4>
                            <p class="text-gray-600">${booking.customerName} • ${booking.phone}</p>
                        </div>
                        <span class="mt-2 sm:mt-0 px-3 py-1 rounded-full text-xs font-medium ${getStatusBadgeClass(booking.status)}">
                            ${getStatusLabel(booking.status)}
                        </span>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
                        <div>
                            <p class="text-gray-700"><strong>Service Type | 服务类型：</strong>${booking.serviceType}</p>
                            <p class="text-gray-700"><strong>Date & Time | 预约时间：</strong>${booking.preferredDate} ${booking.preferredTimeSlot}</p>
                            <p class="text-gray-700"><strong>Key Arrangement | 钥匙安排：</strong>${booking.keyArrangement}</p>
                        </div>
                        <div>
                            <p class="text-gray-700"><strong>Address | 地址：</strong>${booking.address}</p>
                            <p class="text-gray-700"><strong>Email | 邮箱：</strong>${booking.email}</p>
                        </div>
                    </div>

                    ${booking.notes ? `
                        <div class="mb-4">
                            <p class="text-gray-700"><strong>Notes | 备注：</strong></p>
                            <p class="text-gray-600 bg-gray-100 p-2 rounded">${booking.notes}</p>
                        </div>
                    ` : ''}

                    <div class="flex flex-col sm:flex-row gap-2">
                        ${booking.status === 'pending' ? `
                            <button data-booking-id="${booking.id}" class="confirm-btn btn-primary text-white px-4 py-2 rounded-lg text-sm">
                                Confirm | 确认预约
                            </button>
                        ` : ''}
                        
                        ${booking.status === 'confirmed' ? `
                            <button data-booking-id="${booking.id}" class="modify-btn btn-secondary text-white px-4 py-2 rounded-lg text-sm">
                                Modify Time | 修改时间
                            </button>
                        ` : ''}
                        
                        <button data-booking-id="${booking.id}" class="cancel-btn bg-red-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-red-600 transition-all">
                            Cancel | 取消
                        </button>
                        
                        <button data-booking-id="${booking.id}" class="delete-btn bg-gray-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-gray-600 transition-all">
                            Delete | 删除
                        </button>
                    </div>
                </div>
            `).join('');
            
            bindOrderButtons();
        }

        // 绑定订单按钮事件
        function bindOrderButtons() {
            document.querySelectorAll('.confirm-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const bookingId = parseInt(this.dataset.bookingId);
                    confirmBooking(bookingId);
                });
            });
            
            document.querySelectorAll('.cancel-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const bookingId = parseInt(this.dataset.bookingId);
                    cancelBooking(bookingId);
                });
            });

            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const bookingId = parseInt(this.dataset.bookingId);
                    deleteBooking(bookingId);
                });
            });

            document.querySelectorAll('.modify-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const bookingId = parseInt(this.dataset.bookingId);
                    showModifyModal(bookingId);
                });
            });
        }

        // 显示修改时间弹窗
        function showModifyModal(bookingId) {
            const booking = appData.bookings.find(b => b.id === bookingId);
            if (!booking) return;

            appData.currentModifyingBookingId = bookingId;
            
            document.getElementById('newDate').value = booking.preferredDate;
            document.getElementById('newTimeSlot').value = booking.preferredTimeSlot;
            
            document.getElementById('modifyModal').style.display = 'flex';
        }

        // 隐藏修改弹窗
        function hideModifyModal() {
            document.getElementById('modifyModal').style.display = 'none';
            appData.currentModifyingBookingId = null;
        }

        // 确认修改时间
        async function confirmModifyTime() {
            const newDate = document.getElementById('newDate').value;
            const newTimeSlot = document.getElementById('newTimeSlot').value;
            
            if (!newDate || !newTimeSlot) {
                alert('Please fill in all fields | 请填写所有字段');
                return;
            }

            const booking = appData.bookings.find(b => b.id === appData.currentModifyingBookingId);
            if (!booking) return;

            const isConflict = appData.bookings.some(b => 
                b.id !== appData.currentModifyingBookingId && 
                b.preferredDate === newDate && 
                b.preferredTimeSlot === newTimeSlot && 
                b.status === 'confirmed'
            );

            if (isConflict) {
                alert('Time slot conflict! Please choose another time. | 时间冲突！请选择其他时间。');
                return;
            }

            console.log('🔄 正在修改订单时间:', booking.orderNumber);
            
            booking.preferredDate = newDate;
            booking.preferredTimeSlot = newTimeSlot;
            booking.confirmedDate = newDate;
            booking.confirmedTimeSlot = newTimeSlot;
            
            await saveData();
            
            hideModifyModal();
            loadOrdersList();
            generateCalendar();
            
            console.log('✅ 时间修改完成，已同步到云端');
            
            await sendConfirmationEmail(booking, true);
        }

        // 获取状态样式类
        function getStatusBadgeClass(status) {
            const classes = {
                pending: 'bg-yellow-100 text-yellow-800',
                confirmed: 'bg-green-100 text-green-800',
                completed: 'bg-blue-100 text-blue-800',
                cancelled: 'bg-gray-100 text-gray-800'
            };
            return classes[status] || classes.pending;
        }

        // 获取状态标签
        function getStatusLabel(status) {
            const labels = {
                pending: 'Pending | 待确认',
                confirmed: 'Confirmed | 已确认',
                completed: 'Completed | 已完成',
                cancelled: 'Cancelled | 已取消'
            };
            return labels[status] || 'Pending | 待确认';
        }

        // 更新设置
        async function updateSettings() {
            appData.settings.welcomeMessage = document.getElementById('welcomeMessageInput').value;
            appData.settings.noticeMessage = document.getElementById('noticeMessageInput').value;
            appData.settings.afterSubmitNotice = document.getElementById('afterSubmitNoticeInput').value;
            
            await saveData();
            
            const welcomeParagraphs = document.querySelectorAll('#welcomeText');
            if (welcomeParagraphs.length > 0) {
                welcomeParagraphs[0].textContent = appData.settings.welcomeMessage;
            }
            document.getElementById('noticeText').textContent = appData.settings.noticeMessage;
            document.getElementById('afterSubmitNotice').textContent = appData.settings.afterSubmitNotice;
            
            alert('Settings saved successfully! | 设置已保存！');
        }

        // 更新统计数据
        function updateStats() {
            const statsGrid = document.getElementById('statsGrid');
            const totalBookings = appData.bookings.length;
            const pendingBookings = appData.bookings.filter(b => b.status === 'pending').length;
            const confirmedBookings = appData.bookings.filter(b => b.status === 'confirmed').length;
            const completedBookings = appData.bookings.filter(b => b.status === 'completed').length;

            statsGrid.innerHTML = `
                <div class="bg-white p-3 rounded-lg border border-gray-200">
                    <div class="text-2xl font-bold text-blue-900">${totalBookings}</div>
                    <div class="text-sm text-blue-700">Total | 总订单</div>
                </div>
                <div class="bg-white p-3 rounded-lg border border-gray-200">
                    <div class="text-2xl font-bold text-yellow-600">${pendingBookings}</div>
                    <div class="text-sm text-yellow-700">Pending | 待确认</div>
                </div>
                <div class="bg-white p-3 rounded-lg border border-gray-200">
                    <div class="text-2xl font-bold text-green-600">${confirmedBookings}</div>
                    <div class="text-sm text-green-700">Confirmed | 已确认</div>
                </div>
                <div class="bg-white p-3 rounded-lg border border-gray-200">
                    <div class="text-2xl font-bold text-blue-600">${completedBookings}</div>
                    <div class="text-sm text-blue-700">Completed | 已完成</div>
                </div>
            `;
        }

        // 事件绑定
        function bindEvents() {
            const customerTab = document.getElementById('customerTab');
            const adminTab = document.getElementById('adminTab');
            const nextStepBtn = document.getElementById('nextStepBtn');
            const prevStepBtn = document.getElementById('prevStepBtn');
            const submitBtn = document.getElementById('submitBtn');
            const resetBtn = document.getElementById('resetBtn');
            const keyArrangement = document.getElementById('keyArrangement');
            const prevMonth = document.getElementById('prevMonth');
            const nextMonth = document.getElementById('nextMonth');
            const ordersTabBtn = document.getElementById('ordersTabBtn');
            const settingsTabBtn = document.getElementById('settingsTabBtn');
            const saveSettingsBtn = document.getElementById('saveSettingsBtn');
            const showAllOrdersBtn = document.getElementById('showAllOrdersBtn');
            const cancelModify = document.getElementById('cancelModify');
            const confirmModify = document.getElementById('confirmModify');
            const modifyModal = document.getElementById('modifyModal');

            if (customerTab) {
                customerTab.addEventListener('click', showCustomerView);
            }
            if (adminTab) {
                adminTab.addEventListener('click', showAdminView);
            }

            if (nextStepBtn) {
                nextStepBtn.addEventListener('click', function() {
                    if (validateStep1()) {
                        showStep(2);
                        generateDateGrid();
                    }
                });
            }

            if (prevStepBtn) {
                prevStepBtn.addEventListener('click', function() {
                    showStep(1);
                });
            }

            if (submitBtn) {
                submitBtn.addEventListener('click', submitBooking);
            }

            if (resetBtn) {
                resetBtn.addEventListener('click', resetForm);
            }

            if (keyArrangement) {
                keyArrangement.addEventListener('change', function() {
                    const keyOtherSection = document.getElementById('keyOtherSection');
                    if (this.value === 'Other | 其他') {
                        keyOtherSection.style.display = 'block';
                    } else {
                        keyOtherSection.style.display = 'none';
                        const keyOtherDetails = document.getElementById('keyOtherDetails');
                        if (keyOtherDetails) {
                            keyOtherDetails.value = '';
                        }
                    }
                });
            }

            if (prevMonth) {
                prevMonth.addEventListener('click', function() {
                    appData.currentCalendarDate.setMonth(appData.currentCalendarDate.getMonth() - 1);
                    generateCalendar();
                });
            }

            if (nextMonth) {
                nextMonth.addEventListener('click', function() {
                    appData.currentCalendarDate.setMonth(appData.currentCalendarDate.getMonth() + 1);
                    generateCalendar();
                });
            }

            if (ordersTabBtn) {
                ordersTabBtn.addEventListener('click', showOrdersTab);
            }

            if (settingsTabBtn) {
                settingsTabBtn.addEventListener('click', showSettingsTab);
            }

            if (saveSettingsBtn) {
                saveSettingsBtn.addEventListener('click', updateSettings);
            }

            if (showAllOrdersBtn) {
                showAllOrdersBtn.addEventListener('click', function() {
                    appData.selectedCalendarDate = null;
                    appData.showAllOrders = true;
                    this.style.display = 'none';
                    generateCalendar();
                    loadOrdersList();
                });
            }

            if (cancelModify) {
                cancelModify.addEventListener('click', hideModifyModal);
            }

            if (confirmModify) {
                confirmModify.addEventListener('click', confirmModifyTime);
            }

            if (modifyModal) {
                modifyModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        hideModifyModal();
                    }
                });
            }
        }

        // 页面初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 页面加载完成，开始初始化...');
            
            setTimeout(async function() {
                try {
                    await loadData();
                    
                    bindEvents();
                    showCustomerView();
                    
                    const serviceType = document.getElementById('serviceType');
                    const keyArrangement = document.getElementById('keyArrangement');
                    
                    if (serviceType) {
                        serviceType.selectedIndex = 0;
                    }
                    if (keyArrangement) {
                        keyArrangement.selectedIndex = 0;
                    }
                    
                    console.log('🎉 初始化完成！云端数据已加载');
                    
                    if (appData.bookings.length > 0) {
                        console.log(`📊 系统中有 ${appData.bookings.length} 个订单`);
                    }
                    
                } catch (error) {
                    console.error('❌ 初始化时出错:', error);
                    setTimeout(function() {
                        bindEvents();
                        showCustomerView();
                        alert('⚠️ 初始化时遇到问题，已切换到离线模式。功能可能受限。');
                    }, 1000);
                }
            }, 100);
        });
    </script>
</body>
</html><!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property Inspection Booking System | 房产检查预约系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 30%, #f59e0b 70%, #fbbf24 100%);
            min-height: 100vh;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .btn-primary {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(30, 58, 138, 0.4);
        }
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.5);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
        }
        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.5);
        }
        .nav-active {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(30, 58, 138, 0.4);
        }
        .nav-inactive {
            background: rgba(255, 255, 255, 0.2);
            color: #1f2937;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .nav-inactive:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }
        .time-slot-available {
            background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        .time-slot-available:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }
        .time-slot-booked {
            background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
            color: #374151;
            cursor: not-allowed;
        }
        .time-slot-selected {
            background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
            transform: scale(1.05);
        }
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .gradient-text {
            background: linear-gradient(135deg, #1e3a8a 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .admin-bg {
            background: rgba(248, 250, 252, 0.95);
        }
        .calendar-day-selected {
            background-color: #fed7aa !important;
            border-color: #fb923c !important;
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="glass-effect sticky top-0 z-50 mb-6">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col sm:flex-row justify-between items-center h-auto sm:h-16 py-4 sm:py-0">
                <div class="flex items-center mb-4 sm:mb-0">
                    <h1 class="text-xl sm:text-2xl font-bold gradient-text">🏠 Property Inspection Booking | 房产检查预约系统</h1>
                </div>
                <div class="flex space-x-3">
                    <button id="customerTab" class="nav-active px-4 py-2 rounded-lg font-semibold transition-all">
                        Customer Booking<br>客户预约
                    </button>
                    <button id="adminTab" class="nav-inactive px-4 py-2 rounded-lg font-semibold transition-all">
                        Admin Panel<br>后台管理
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- 客户预约视图 -->
        <div id="customerView">
            <!-- 欢迎区域 -->
            <div class="text-center mb-8 fade-in">
                <div class="glass-effect p-6 sm:p-8 rounded-2xl shadow-xl card-hover">
                    <h2 class="text-2xl sm:text-4xl font-bold mb-4 gradient-text">✨ Professional Property Inspection Service</h2>
                    <h2 class="text-2xl sm:text-4xl font-bold mb-4 gradient-text">专业房产检查服务</h2>
                    <p id="welcomeText" class="text-lg sm:text-xl text-gray-700 leading-relaxed">
                        Welcome to our property inspection booking system! We provide professional and caring property inspection services.
                    </p>
                    <p class="text-lg sm:text-xl text-gray-700 leading-relaxed mt-2">
                        欢迎使用房产检查预约系统！我们提供专业、贴心的房产检查服务。
                    </p>
                </div>
            </div>

            <!-- 步骤1：基本信息 -->
            <div id="step1">
                <div class="glass-effect rounded-2xl p-6 sm:p-8 shadow-xl card-hover">
                    <h3 class="text-xl sm:text-2xl font-bold mb-2 gradient-text">📝 Basic Information</h3>
                    <h3 class="text-xl sm:text-2xl font-bold mb-6 gradient-text">基本信息</h3>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Full Name | 姓名 <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="customerName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Please enter your full name | 请输入您的姓名">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Phone Number | 手机号 <span class="text-red-500">*</span>
                            </label>
                            <input type="tel" id="phone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Please enter your phone number | 请输入手机号">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Email Address | 邮箱 <span class="text-red-500">*</span>
                            </label>
                            <input type="email" id="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Please enter your email address | 请输入邮箱地址">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Postcode | 邮编
                            </label>
                            <input type="text" id="postcode" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Please enter postcode | 请输入邮编">
                        </div>

                        <div class="lg:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Property Address | 房产地址 <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="address" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Please enter detailed address | 请输入详细地址">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Service Type | 服务类型 <span class="text-red-500">*</span>
                            </label>
                            <select id="serviceType" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                <option value="Mid-term Inspection | 期中检查">Mid-term Inspection | 期中检查</option>
                                <option value="Final Inspection | 期末检查">Final Inspection | 期末检查</option>
                                <option value="Property Viewing | 实地看房">Property Viewing | 实地看房</option>
                                <option value="Virtual Viewing | 连线看房">Virtual Viewing | 连线看房</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Key Arrangement | 钥匙安排 <span class="text-red-500">*</span>
                            </label>
                            <select id="keyArrangement" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                <option value="Customer Keeps | 客户保留">Customer Keeps | 客户保留</option>
                                <option value="Handover to Inspector | 交给检查员">Handover to Inspector | 交给检查员</option>
                                <option value="Other | 其他">Other | 其他</option>
                            </select>
                        </div>

                        <!-- 钥匙安排其他选项的说明 -->
                        <div id="keyOtherSection" style="display: none;" class="lg:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Key Arrangement Details | 钥匙安排说明 <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="keyOtherDetails" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Please specify the key arrangement details | 请详细说明钥匙的具体安排">
                        </div>
                    </div>

                    <div class="mt-8 text-center">
                        <button id="nextStepBtn" class="btn-primary text-white px-6 sm:px-8 py-3 sm:py-4 rounded-lg font-semibold text-lg">
                            Next: Select Time<br>下一步：选择时间 →
                        </button>
                    </div>
                </div>
            </div>

            <!-- 步骤2：选择时间 -->
            <div id="step2" style="display: none;">
                <div class="glass-effect rounded-2xl p-6 sm:p-8 shadow-xl card-hover fade-in">
                    <h3 class="text-xl sm:text-2xl font-bold mb-2 gradient-text">📅 Select Appointment Time</h3>
                    <h3 class="text-xl sm:text-2xl font-bold mb-6 gradient-text">选择预约时间</h3>
                    
                    <div class="mb-8">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Select Date <span class="text-red-500">*</span>
                        </label>
                        <label class="block text-sm font-medium text-gray-700 mb-4">
                            选择日期 <span class="text-red-500">*</span>
                        </label>
                        <div id="dateGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3">
                            <!-- 日期选项 -->
                        </div>
                    </div>

                    <div id="timeSlotSection" style="display: none;" class="mb-8">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Select Time Slot <span class="text-red-500">*</span>
                        </label>
                        <label class="block text-sm font-medium text-gray-700 mb-4">
                            选择时间段 <span class="text-red-500">*</span>
                        </label>
                        <div id="timeSlotGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                            <!-- 时间段选项 -->
                        </div>
                        
                        <div class="mt-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Other Time Requirements
                            </label>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                其他时间需求（非标准时段）
                            </label>
                            <textarea id="specialRequirements" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" rows="3" placeholder="If you need other time arrangements, please specify here | 如需其他时间安排，请在此说明（不保证能满足）"></textarea>
                        </div>
                    </div>

                    <div class="mb-8">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Notes
                        </label>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            备注
                        </label>
                        <textarea id="notes" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" rows="3" placeholder="If you have other matters to explain, please fill in here | 如有其他需要说明的事项，请在此填写"></textarea>
                    </div>

                    <div class="flex flex-col sm:flex-row justify-between gap-4">
                        <button id="prevStepBtn" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all">
                            ← Previous | 上一步
                        </button>
                        <button id="submitBtn" class="btn-primary text-white px-6 sm:px-8 py-3 rounded-lg font-semibold opacity-50 cursor-not-allowed" disabled>
                            Submit Booking | 提交预约
                        </button>
                    </div>
                </div>
            </div>

            <!-- 步骤3：确认页面 -->
            <div id="step3" style="display: none;">
                <div class="glass-effect rounded-2xl p-6 sm:p-8 shadow-xl text-center card-hover fade-in">
                    <div class="text-4xl sm:text-6xl mb-6">✅</div>
                    <h2 class="text-2xl sm:text-3xl font-bold text-green-600 mb-2">Booking Submitted Successfully!</h2>
                    <h2 class="text-2xl sm:text-3xl font-bold text-green-600 mb-4">预约提交成功！</h2>
                    
                    <div class="bg-green-50 border-2 border-green-200 rounded-lg p-6 mb-6">
                        <p class="text-lg text-green-800 mb-2">Your order number is | 您的订单号是：</p>
                        <p id="orderNumber" class="text-2xl sm:text-3xl font-bold text-green-900"></p>
                        <p class="text-sm text-green-600 mt-2">Please save this order number for future reference | 请保存此订单号，以便后续查询</p>
                    </div>

                    <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-6 mb-6 text-left">
                        <h3 class="font-bold text-blue-900 mb-3">Booking Details | 预约详情：</h3>
                        <div id="bookingDetails" class="space-y-2 text-blue-800">
                            <!-- 预约详情 -->
                        </div>
                    </div>

                    <div class="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-6 mb-6 text-left">
                        <h3 class="font-bold text-yellow-900 mb-3">📋 Important Notes | 注意事项：</h3>
                        <div id="noticeText" class="text-yellow-800 whitespace-pre-line">
Please note:
• Please ensure the appointment time is accurate
• For cancellations or modifications, please contact us 24 hours in advance
• Please prepare relevant documents on the inspection day
• If you have special requirements, please specify in the remarks

请注意：
• 请确保预约时间准确无误
• 如需取消或修改，请提前24小时联系
• 检查当天请准备好相关文件
• 如有特殊要求，请在备注中说明
                        </div>
                    </div>

                    <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-6 mb-6 text-left">
                        <h3 class="font-bold text-blue-900 mb-3">📢 Important Notice | 重要提示：</h3>
                        <div id="afterSubmitNotice" class="text-blue-800 whitespace-pre-line">
We will confirm your appointment details within 24 hours.
If you have any questions, please contact us anytime.
Thank you for your trust!

我们会在24小时内与您确认预约详情。
如有任何疑问，请随时联系我们。
谢谢您的信任！
                        </div>
                    </div>

                    <div class="text-center">
                        <button id="resetBtn" class="btn-secondary text-white px-6 sm:px-8 py-3 rounded-lg font-semibold">
                            Book Other Services<br>预约其他服务
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 管理员视图 -->
        <div id="adminView" style="display: none;">
            <!-- 日历视图 -->
            <div class="glass-effect rounded-2xl p-6 shadow-xl card-hover mb-6">
                <div class="flex flex-col sm:flex-row justify-between items-center mb-4">
                    <h3 class="text-xl font-bold gradient-text">📅 Appointment Calendar | 预约日历</h3>
                    <div class="flex items-center space-x-2 mt-4 sm:mt-0">
                        <button id="prevMonth" class="btn-primary text-white px-3 py-2 rounded-lg text-sm">‹</button>
                        <span id="currentMonthYear" class="text-lg font-semibold mx-4 text-gray-700"></span>
                        <button id="nextMonth" class="btn-primary text-white px-3 py-2 rounded-lg text-sm">›</button>
                    </div>
                </div>
                <div id="calendarGrid" class="grid grid-cols-7 gap-2">
                    <!-- 日历网格 -->
                </div>
                <div class="mt-4 text-sm text-gray-600">
                    <p>Click on a date to filter orders for that day | 点击日期可筛选当天订单</p>
                    <p>Blue dots indicate confirmed appointments | 蓝点表示已确认的预约</p>
                </div>
            </div>

            <!-- 后台管理标签页 -->
            <div class="flex space-x-1 bg-gray-100 p-1 rounded-lg mb-6">
                <button id="ordersTabBtn" class="flex-1 py-3 px-4 rounded-md font-medium transition-all nav-active">
                    📋 Order Management | 订单管理
                </button>
                <button id="settingsTabBtn" class="flex-1 py-3 px-4 rounded-md font-medium transition-all nav-inactive">
                    ⚙️ System Settings | 系统设置
                </button>
            </div>

            <!-- 订单管理 -->
            <div id="ordersTab" class="glass-effect rounded-2xl p-6 shadow-xl card-hover">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold gradient-text">Order Management | 订单管理</h3>
                    <button id="showAllOrdersBtn" class="btn-secondary text-white px-4 py-2 rounded-lg text-sm" style="display: none;">
                        Show All Orders | 显示所有订单
                    </button>
                </div>
                <div id="ordersList">
                    <p class="text-center text-gray-500 py-8">Loading orders... | 正在加载订单数据...</p>
                </div>
            </div>

            <!-- 系统设置 -->
            <div id="settingsTab" style="display: none;" class="glass-effect rounded-2xl p-6 shadow-xl card-hover">
                <h3 class="text-xl font-bold gradient-text mb-6">System Settings | 系统设置</h3>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Customer Welcome Message | 客户端欢迎信息
                        </label>
                        <textarea id="welcomeMessageInput" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" rows="3">Welcome to our property inspection booking system! We provide professional and caring property inspection services.</textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Important Notes After Submission | 提交后注意事项
                        </label>
                        <textarea id="noticeMessageInput" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" rows="6">Please note:
• Please ensure the appointment time is accurate
• For cancellations or modifications, please contact us 24 hours in advance
• Please prepare relevant documents on the inspection day
• If you have special requirements, please specify in the remarks

请注意：
• 请确保预约时间准确无误
• 如需取消或修改，请提前24小时联系
• 检查当天请准备好相关文件
• 如有特殊要求，请在备注中说明</textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Important Notice After Submission | 提交后重要提示
                        </label>
                        <textarea id="afterSubmitNoticeInput" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" rows="4">We will confirm your appointment details within 24 hours.
If you have any questions, please contact us anytime.
Thank you for your trust!

我们会在24小时内与您确认预约详情。
如有任何疑问，请随时联系我们。
谢谢您的信任！</textarea>