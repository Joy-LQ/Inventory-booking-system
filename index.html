<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Inventory Booking System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Add your CSS links or stylesheets here -->
    <style>
        body { font-family: Arial, sans-serif; background: #f7f8fa; margin: 0; }
        .container { max-width: 1100px; margin: 40px auto; background: #fff; border-radius: 12px; box-shadow: 0 2px 12px #0001; padding: 28px 34px; }
        .nav-active { background: #e3f2fd; color: #1565c0; }
        .nav-inactive { background: #f9f9f9; color: #888; }
        .btn-primary { background: #1976d2; }
        .btn-secondary { background: #ff9800; }
        .card-hover:hover { box-shadow: 0 2px 12px #1976d233; }
        .admin-bg { background: #f8fafc; }
    </style>
</head>
<body>
    <div class="container">
        <nav style="display: flex; gap: 12px; margin-bottom: 24px;">
            <button id="customerTab" class="nav-active px-4 py-2 rounded-lg font-semibold transition-all">Customer</button>
            <button id="adminTab" class="nav-inactive px-4 py-2 rounded-lg font-semibold transition-all">Admin</button>
        </nav>
        <div id="customerView">
            <h2 id="welcomeText"></h2>
            <!-- Booking form steps -->
            <div id="step1">
                <!-- Step 1 form fields -->
                <label>Name: <input id="customerName" required></label><br>
                <label>Phone: <input id="phone" required></label><br>
                <label>Email: <input id="email" required></label><br>
                <label>Address: <input id="address" required></label><br>
                <label>Postcode: <input id="postcode"></label><br>
                <label>Service Type:
                    <select id="serviceType">
                        <option value="">Select</option>
                        <option value="Inspection">Inspection</option>
                        <option value="Valuation">Valuation</option>
                    </select>
                </label><br>
                <label>Key Arrangement:
                    <select id="keyArrangement">
                        <option value="">Select</option>
                        <option value="Onsite">Onsite</option>
                        <option value="Agent">Agent</option>
                        <option value="Other | ÂÖ∂‰ªñ">Other | ÂÖ∂‰ªñ</option>
                    </select>
                </label>
                <div id="keyOtherSection" style="display:none;">
                    <label>Key Arrangement Details: <input id="keyOtherDetails"></label>
                </div>
                <label>Special Requirements: <input id="specialRequirements"></label><br>
                <label>Notes: <input id="notes"></label><br>
                <button id="nextStepBtn">Next</button>
            </div>
            <div id="step2" style="display:none;">
                <h3>Select Date</h3>
                <div id="dateGrid"></div>
                <div id="timeSlotSection" style="display:none;">
                    <h3>Select Time Slot</h3>
                    <div id="timeSlotGrid"></div>
                </div>
                <button id="prevStepBtn">Previous</button>
                <button id="submitBtn" disabled>Submit</button>
            </div>
            <div id="step3" style="display:none;">
                <h3>Booking Submitted!</h3>
                <p>Your order number: <span id="orderNumber"></span></p>
                <div id="bookingDetails"></div>
                <p id="afterSubmitNotice"></p>
                <button id="resetBtn">Book Again</button>
            </div>
            <div id="noticeText" style="margin-top:24px; color:#e65100;"></div>
        </div>
        <div id="adminView" style="display:none;">
            <div style="display:flex; gap:8px; margin-bottom:18px;">
                <button id="ordersTabBtn" class="flex-1 py-3 px-4 rounded-md font-medium transition-all nav-active">Orders</button>
                <button id="settingsTabBtn" class="flex-1 py-3 px-4 rounded-md font-medium transition-all nav-inactive">Settings</button>
            </div>
            <div id="ordersTab">
                <button id="showAllOrdersBtn" style="display:none; margin-bottom:10px;">Show All Orders</button>
                <div id="calendarSection" style="margin-bottom: 24px;">
                    <div style="display:flex;align-items:center;gap:10px;">
                        <button id="prevMonth">&lt;</button>
                        <span id="currentMonthYear" style="font-weight:bold;"></span>
                        <button id="nextMonth">&gt;</button>
                    </div>
                    <div id="calendarGrid" style="display:grid;grid-template-columns:repeat(7,1fr);gap:2px;margin-top:10px;"></div>
                </div>
                <div id="ordersList"></div>
            </div>
            <div id="settingsTab" style="display:none;">
                <label>Welcome Message:<br>
                    <textarea id="welcomeMessageInput"></textarea>
                </label><br>
                <label>Notice Message:<br>
                    <textarea id="noticeMessageInput"></textarea>
                </label><br>
                <label>After Submit Notice:<br>
                    <textarea id="afterSubmitNoticeInput"></textarea>
                </label><br>
                <button id="saveSettingsBtn">Save</button>
                <div id="statsGrid" style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:24px;"></div>
            </div>
        </div>
    </div>
    <div id="modifyModal" style="display:none; position:fixed; top:0; left:0;right:0;bottom:0; background:rgba(0,0,0,0.2); align-items:center; justify-content:center;">
        <div style="background:#fff; padding:20px; border-radius:8px; min-width:300px;">
            <h3>Modify Booking Time</h3>
            <label for="newDate">New Date:</label>
            <input type="date" id="newDate"><br><br>
            <label for="newTimeSlot">New Time Slot:</label>
            <select id="newTimeSlot">
                <option value="10:00-11:30">10:00-11:30</option>
                <option value="11:30-13:00">11:30-13:00</option>
                <option value="13:00-14:30">13:00-14:30</option>
            </select><br><br>
            <button id="confirmModify">Confirm</button>
            <button id="cancelModify">Cancel</button>
        </div>
    </div>
    <script>
        // Â∫îÁî®Êï∞ÊçÆ
        const appData = {
            bookings: [],
            settings: {
                welcomeMessage: 'Welcome to our property inspection booking system! We provide professional and caring property inspection services.',
                noticeMessage: 'Please note:\n‚Ä¢ Please ensure the appointment time is accurate\n‚Ä¢ For cancellations or modifications, please contact us 24 hours in advance\n‚Ä¢ Please prepare r[...]',
                afterSubmitNotice: 'We will confirm your appointment details within 24 hours.\nIf you have any questions, please contact us anytime.\nThank you for your trust!\n\nÊàë‰ª¨‰ºöÂú®24Â∞èÔøΩ[...]'
            },
            nextOrderNumber: 1,
            selectedDate: '',
            selectedTimeSlot: '',
            currentCalendarDate: new Date(),
            selectedCalendarDate: null,
            showAllOrders: true,
            currentModifyingBookingId: null
        };

        // üåê ‰∫ëÁ´ØÊï∞ÊçÆÂ≠òÂÇ®ÂáΩÊï∞
        async function saveToCloud() {
            try {
                console.log('üåê Ê≠£Âú®‰øùÂ≠òÂà∞‰∫ëÁ´ØÊï∞ÊçÆÂ∫ì...');
                const response = await fetch('/api/bookings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        bookings: appData.bookings,
                        settings: appData.settings,
                        nextOrderNumber: appData.nextOrderNumber
                    })
                });

                const result = await response.json();
                
                if (response.ok) {
                    console.log('‚úÖ ‰∫ëÁ´Ø‰øùÂ≠òÊàêÂäü!', result);
                    return true;
                } else {
                    console.error('‚ùå ‰∫ëÁ´Ø‰øùÂ≠òÂ§±Ë¥•:', result);
                    return false;
                }
            } catch (error) {
                console.error('‚ùå ‰∫ëÁ´Ø‰øùÂ≠òÈîôËØØ:', error);
                return false;
            }
        }

        // üìÇ ‰∫ëÁ´ØÊï∞ÊçÆÂä†ËΩΩÂáΩÊï∞
        async function loadFromCloud() {
            try {
                console.log('üåê Ê≠£Âú®‰ªé‰∫ëÁ´ØÊï∞ÊçÆÂ∫ìÂä†ËΩΩ...');
                const response = await fetch('/api/bookings');
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('üì¶ Êî∂Âà∞‰∫ëÁ´ØÊï∞ÊçÆ:', data);
                    
                    if (data.success) {
                        // Êõ¥Êñ∞Êú¨Âú∞Êï∞ÊçÆ
                        appData.bookings = data.bookings || [];
                        appData.settings = { ...appData.settings, ...data.settings };
                        appData.nextOrderNumber = data.nextOrderNumber || 1;
                        
                        console.log(`‚úÖ ÊàêÂäüÂä†ËΩΩ ${appData.bookings.length} ‰∏™ËÆ¢Âçï`);
                        return true;
                    }
                } else {
                    console.error('‚ùå ‰∫ëÁ´ØÂä†ËΩΩÂ§±Ë¥•:', response.status);
                    return false;
                }
            } catch (error) {
                console.error('‚ùå ‰∫ëÁ´ØÂä†ËΩΩÈîôËØØ:', error);
                return false;
            }
        }

        // üíæ Êô∫ËÉΩÊï∞ÊçÆ‰øùÂ≠òÂáΩÊï∞Ôºà‰∫ëÁ´Ø‰ºòÂÖàÔºåÊú¨Âú∞Â§á‰ªΩÔºâ
        async function saveData() {
            // ÂÖà‰øùÂ≠òÂà∞Êú¨Âú∞‰Ωú‰∏∫Â§á‰ªΩ
            try {
                const dataToSave = {
                    bookings: appData.bookings,
                    nextOrderNumber: appData.nextOrderNumber,
                    settings: appData.settings,
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem('propertyBookingData', JSON.stringify(dataToSave));
                console.log('üíæ Êú¨Âú∞Â§á‰ªΩÂ∑≤‰øùÂ≠ò');
            } catch (error) {
                console.error('‚ùå Êú¨Âú∞Â§á‰ªΩÂ§±Ë¥•:', error);
            }
            
            // Â∞ùËØï‰øùÂ≠òÂà∞‰∫ëÁ´Ø
            const cloudSuccess = await saveToCloud();
            
            if (cloudSuccess) {
                console.log('üéâ Êï∞ÊçÆÂ∑≤ÊàêÂäü‰øùÂ≠òÂà∞‰∫ëÁ´ØÂπ∂Êú¨Âú∞Â§á‰ªΩ');
            } else {
                console.log('‚ö†Ô∏è ‰∫ëÁ´Ø‰øùÂ≠òÂ§±Ë¥•Ôºå‰ΩÜÊú¨Âú∞Â§á‰ªΩÂ∑≤‰øùÂ≠ò');
            }
        }

        // üîÑ Êô∫ËÉΩÊï∞ÊçÆÂä†ËΩΩÂáΩÊï∞Ôºà‰∫ëÁ´Ø‰ºòÂÖàÔºåÊú¨Âú∞ÂÖúÂ∫ïÔºâ
        async function loadData() {
            console.log('üîÑ ÂºÄÂßãÂä†ËΩΩÊï∞ÊçÆ...');
            
            // Â∞ùËØï‰ªé‰∫ëÁ´ØÂä†ËΩΩ
            const cloudSuccess = await loadFromCloud();
            
            if (!cloudSuccess) {
                console.log('‚ö†Ô∏è ‰∫ëÁ´ØÂä†ËΩΩÂ§±Ë¥•ÔºåÂ∞ùËØïÊú¨Âú∞Â§á‰ªΩ...');
                try {
                    const saved = localStorage.getItem('propertyBookingData');
                    if (saved) {
                        const data = JSON.parse(saved);
                        appData.bookings = data.bookings || [];
                        appData.nextOrderNumber = data.nextOrderNumber || 1;
                        if (data.settings) {
                            appData.settings = { ...appData.settings, ...data.settings };
                        }
                        console.log('üíæ Êú¨Âú∞Â§á‰ªΩÊï∞ÊçÆÂ∑≤Âä†ËΩΩ');
                    }
                } catch (error) {
                    console.error('‚ùå Êú¨Âú∞Â§á‰ªΩÂä†ËΩΩÂ§±Ë¥•:', error);
                }
            }
            
            console.log('‚úÖ Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê');
        }

        // ... (All the rest of your JavaScript code from the previous index.html)
        // Please paste the remainder of your JavaScript here as in your original file.
        // For brevity, the full code is not shown here, but you should include every function and event binding.

        // È°µÈù¢ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ È°µÈù¢Âä†ËΩΩÂÆåÊàêÔºåÂºÄÂßãÂàùÂßãÂåñ...');
            
            setTimeout(async function() {
                try {
                    await loadData();
                    
                    bindEvents();
                    showCustomerView();
                    
                    const serviceType = document.getElementById('serviceType');
                    const keyArrangement = document.getElementById('keyArrangement');
                    
                    if (serviceType) {
                        serviceType.selectedIndex = 0;
                    }
                    if (keyArrangement) {
                        keyArrangement.selectedIndex = 0;
                    }
                    
                    console.log('üéâ ÂàùÂßãÂåñÂÆåÊàêÔºÅ‰∫ëÁ´ØÊï∞ÊçÆÂ∑≤Âä†ËΩΩ');
                    
                    if (appData.bookings.length > 0) {
                        console.log(`üìä Á≥ªÁªü‰∏≠Êúâ ${appData.bookings.length} ‰∏™ËÆ¢Âçï`);
                    }
                    
                } catch (error) {
                    console.error('‚ùå ÂàùÂßãÂåñÊó∂Âá∫Èîô:', error);
                    setTimeout(function() {
                        bindEvents();
                        showCustomerView();
                    }, 1000);
                }
            }, 300);
        });

        // (End of script)
    </script>
</body>
</html>
