                    </div>

                    <button id="saveSettingsBtn" class="btn-primary text-white px-6 py-3 rounded-lg font-semibold">
                        Save Settings | ä¿å­˜è®¾ç½®
                    </button>

                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h4 class="font-medium text-blue-900 mb-2">ğŸ“Š Data Statistics | æ•°æ®ç»Ÿè®¡</h4>
                        <div id="statsGrid" class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                            <!-- ç»Ÿè®¡æ•°æ® -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¿®æ”¹æ—¶é—´å¼¹çª— -->
    <div id="modifyModal" style="display: none;" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="glass-effect rounded-2xl p-6 max-w-md w-full mx-4">
            <h3 class="text-xl font-bold mb-4 gradient-text">Modify Appointment Time | ä¿®æ”¹é¢„çº¦æ—¶é—´</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        New Date | æ–°æ—¥æœŸ <span class="text-red-500">*</span>
                    </label>
                    <input type="date" id="newDate" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        New Time Slot | æ–°æ—¶é—´æ®µ <span class="text-red-500">*</span>
                    </label>
                    <select id="newTimeSlot" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="10:00-11:30">10:00-11:30</option>
                        <option value="11:30-13:00">11:30-13:00</option>
                        <option value="13:00-14:30">13:00-14:30</option>
                    </select>
                </div>
            </div>
            
            <div class="flex space-x-3 mt-6">
                <button id="cancelModify" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                    Cancel | å–æ¶ˆ
                </button>
                <button id="confirmModify" class="flex-1 btn-primary text-white px-4 py-2 rounded-lg">
                    Confirm | ç¡®è®¤
                </button>
            </div>
        </div>
    </div>

    <script>
        // åº”ç”¨æ•°æ®
        const appData = {
            bookings: [],
            settings: {
                welcomeMessage: 'Welcome to our property inspection booking system! We provide professional and caring property inspection services.',
                noticeMessage: 'Please note:\nâ€¢ Please ensure the appointment time is accurate\nâ€¢ For cancellations or modifications, please contact us 24 hours in advance\nâ€¢ Please prepare relevant documents on the inspection day\nâ€¢ If you have special requirements, please specify in the remarks\n\nè¯·æ³¨æ„ï¼š\nâ€¢ è¯·ç¡®ä¿é¢„çº¦æ—¶é—´å‡†ç¡®æ— è¯¯\nâ€¢ å¦‚éœ€å–æ¶ˆæˆ–ä¿®æ”¹ï¼Œè¯·æå‰24å°æ—¶è”ç³»\nâ€¢ æ£€æŸ¥å½“å¤©è¯·å‡†å¤‡å¥½ç›¸å…³æ–‡ä»¶\nâ€¢ å¦‚æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œè¯·åœ¨å¤‡æ³¨ä¸­è¯´æ˜',
                afterSubmitNotice: 'We will confirm your appointment details within 24 hours.\nIf you have any questions, please contact us anytime.\nThank you for your trust!\n\næˆ‘ä»¬ä¼šåœ¨24å°æ—¶å†…ä¸æ‚¨ç¡®è®¤é¢„çº¦è¯¦æƒ…ã€‚\nå¦‚æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·éšæ—¶è”ç³»æˆ‘ä»¬ã€‚\nè°¢è°¢æ‚¨çš„ä¿¡ä»»ï¼'
            },
            nextOrderNumber: 1,
            selectedDate: '',
            selectedTimeSlot: '',
            currentCalendarDate: new Date(),
            selectedCalendarDate: null,
            showAllOrders: true,
            currentModifyingBookingId: null,
            lastCloudSync: null,
            autoRefreshInterval: null
        };

        // ğŸŒ äº‘ç«¯æ•°æ®å­˜å‚¨å‡½æ•°
        async function saveToCloud() {
            try {
                console.log('ğŸŒ æ­£åœ¨ä¿å­˜åˆ°äº‘ç«¯æ•°æ®åº“...');
                const response = await fetch('/api/bookings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        bookings: appData.bookings,
                        settings: appData.settings,
                        nextOrderNumber: appData.nextOrderNumber
                    })
                });

                const result = await response.json();
                
                if (response.ok) {
                    console.log('âœ… äº‘ç«¯ä¿å­˜æˆåŠŸ!', result);
                    appData.lastCloudSync = new Date();
                    return true;
                } else {
                    console.error('âŒ äº‘ç«¯ä¿å­˜å¤±è´¥:', result);
                    return false;
                }
            } catch (error) {
                console.error('âŒ äº‘ç«¯ä¿å­˜é”™è¯¯:', error);
                return false;
            }
        }

        // ğŸ“‚ äº‘ç«¯æ•°æ®åŠ è½½å‡½æ•°
        async function loadFromCloud() {
            try {
                console.log('ğŸŒ æ­£åœ¨ä»äº‘ç«¯æ•°æ®åº“åŠ è½½...');
                const response = await fetch('/api/bookings');
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('ğŸ“¦ æ”¶åˆ°äº‘ç«¯æ•°æ®:', data);
                    
                    if (data.success) {
                        appData.bookings = data.bookings || [];
                        appData.settings = { ...appData.settings, ...data.settings };
                        appData.nextOrderNumber = data.nextOrderNumber || 1;
                        appData.lastCloudSync = new Date();
                        
                        console.log(`âœ… æˆåŠŸåŠ è½½ ${appData.bookings.length} ä¸ªè®¢å•`);
                        return true;
                    }
                } else {
                    console.error('âŒ äº‘ç«¯åŠ è½½å¤±è´¥:', response.status);
                    return false;
                }
            } catch (error) {
                console.error('âŒ äº‘ç«¯åŠ è½½é”™è¯¯:', error);
                return false;
            }
        }

        // ğŸ’¾ æ™ºèƒ½æ•°æ®ä¿å­˜å‡½æ•°
        async function saveData() {
            try {
                const dataToSave = {
                    bookings: appData.bookings,
                    nextOrderNumber: appData.nextOrderNumber,
                    settings: appData.settings,
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem('propertyBookingData', JSON.stringify(dataToSave));
                console.log('ğŸ’¾ æœ¬åœ°å¤‡ä»½å·²ä¿å­˜');
            } catch (error) {
                console.error('âŒ æœ¬åœ°å¤‡ä»½å¤±è´¥:', error);
            }
            
            const cloudSuccess = await saveToCloud();
            
            if (cloudSuccess) {
                console.log('ğŸ‰ æ•°æ®å·²æˆåŠŸä¿å­˜åˆ°äº‘ç«¯å¹¶æœ¬åœ°å¤‡ä»½');
            } else {
                console.log('âš ï¸ äº‘ç«¯ä¿å­˜å¤±è´¥ï¼Œä½†æœ¬åœ°å¤‡ä»½å·²ä¿å­˜');
            }
        }

        // ğŸ”„ æ™ºèƒ½æ•°æ®åŠ è½½å‡½æ•°
        async function loadData() {
            console.log('ğŸ”„ å¼€å§‹åŠ è½½æ•°æ®...');
            
            const cloudSuccess = await loadFromCloud();
            
            if (!cloudSuccess) {
                console.log('âš ï¸ äº‘ç«¯åŠ è½½å¤±è´¥ï¼Œå°è¯•æœ¬åœ°å¤‡ä»½...');
                try {
                    const saved = localStorage.getItem('propertyBookingData');
                    if (saved) {
                        const data = JSON.parse(saved);
                        appData.bookings = data.bookings || [];
                        appData.nextOrderNumber = data.nextOrderNumber || 1;
                        if (data.settings) {
                            appData.settings = { ...appData.settings, ...data.settings };
                        }
                        console.log('ğŸ’¾ æœ¬åœ°å¤‡ä»½æ•°æ®å·²åŠ è½½');
                    }
                } catch (error) {
                    console.error('âŒ æœ¬åœ°å¤‡ä»½åŠ è½½å¤±è´¥:', error);
                }
            }
            
            if (document.getElementById('welcomeText')) {
                document.getElementById('welcomeText').textContent = appData.settings.welcomeMessage;
            }
            
            console.log('âœ… æ•°æ®åŠ è½½å®Œæˆ');
        }

        // ğŸ”„ è‡ªåŠ¨åˆ·æ–°
        function startAutoRefresh() {
            if (appData.autoRefreshInterval) {
                clearInterval(appData.autoRefreshInterval);
            }
            
            appData.autoRefreshInterval = setInterval(async () => {
                if (document.getElementById('adminView').style.display !== 'none') {
                    console.log('ğŸ”„ è‡ªåŠ¨åˆ·æ–°æ•°æ®...');
                    await loadFromCloud();
                    loadOrdersList();
                    generateCalendar();
                    updateStats();
                }
            }, 30000);
        }

        function stopAutoRefresh() {
            if (appData.autoRefreshInterval) {
                clearInterval(appData.autoRefreshInterval);
                appData.autoRefreshInterval = null;
            }
        }

        // è§†å›¾åˆ‡æ¢
        function showCustomerView() {
            document.getElementById('customerView').style.display = 'block';
            document.getElementById('adminView').style.display = 'none';
            document.getElementById('customerTab').className = 'nav-active px-4 py-2 rounded-lg font-semibold transition-all';
            document.getElementById('adminTab').className = 'nav-inactive px-4 py-2 rounded-lg font-semibold transition-all';
            stopAutoRefresh();
        }

        async function showAdminView() {
            const password = prompt('Please enter admin password | è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç :');
            if (password === 'admin123') {
                document.getElementById('customerView').style.display = 'none';
                document.getElementById('adminView').style.display = 'block';
                document.getElementById('adminTab').className = 'nav-active px-4 py-2 rounded-lg font-semibold transition-all';
                document.getElementById('customerTab').className = 'nav-inactive px-4 py-2 rounded-lg font-semibold transition-all';
                
                await loadFromCloud();
                generateCalendar();
                showOrdersTab();
                startAutoRefresh();
            } else if (password !== null) {
                alert('Incorrect password! | å¯†ç é”™è¯¯ï¼');
            }
        }

        // æ­¥éª¤æ§åˆ¶
        function showStep(stepNumber) {
            document.getElementById('step1').style.display = stepNumber === 1 ? 'block' : 'none';
            document.getElementById('step2').style.display = stepNumber === 2 ? 'block' : 'none';
            document.getElementById('step3').style.display = stepNumber === 3 ? 'block' : 'none';
        }

        // éªŒè¯ç¬¬ä¸€æ­¥
        function validateStep1() {
            const required = ['customerName', 'phone', 'email', 'address', 'serviceType', 'keyArrangement'];
            for (const field of required) {
                if (!document.getElementById(field).value.trim()) {
                    alert('Please fill in all required fields! | è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µï¼');
                    return false;
                }
            }
            
            if (document.getElementById('keyArrangement').value === 'Other | å…¶ä»–') {
                if (!document.getElementById('keyOtherDetails').value.trim()) {
                    alert('Please specify the key arrangement details! | è¯·è¯¦ç»†è¯´æ˜é’¥åŒ™çš„å…·ä½“å®‰æ’ï¼');
                    return false;
                }
            }
            
            return true;
        }

        // ç”Ÿæˆå¯ç”¨æ—¥æœŸ
        function generateAvailableDates() {
            const dates = [];
            const today = new Date();
            
            for (let i = 1; i <= 30; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                
                if (date.getDay() >= 1 && date.getDay() <= 5) {
                    dates.push(date.toISOString().split('T')[0]);
                }
            }
            return dates;
        }

        // æ£€æŸ¥æ—¶é—´æ®µæ˜¯å¦è¢«é¢„çº¦
        function isTimeSlotBooked(date, timeSlot) {
            return appData.bookings.some(booking => 
                booking.preferredDate === date && 
                booking.preferredTimeSlot === timeSlot &&
                booking.status === 'confirmed'
            );
        }

        // ç”Ÿæˆæ—¥æœŸç½‘æ ¼
        async function generateDateGrid() {
            await loadFromCloud();
            
            const dates = generateAvailableDates();
            const dateGrid = document.getElementById('dateGrid');
            dateGrid.innerHTML = '';

            dates.slice(0, 12).forEach(date => {
                const timeSlots = ['10:00-11:30', '11:30-13:00', '13:00-14:30'];
                const hasAvailableSlots = timeSlots.some(slot => !isTimeSlotBooked(date, slot));
                
                if (hasAvailableSlots) {
                    const dateObj = new Date(date);
                    const button = document.createElement('button');
                    button.type = 'button';
                    button.className = 'p-3 rounded-lg border-2 transition-all hover:scale-105 border-gray-200 hover:border-blue-300 hover:bg-blue-50 bg-white';
                    
                    button.addEventListener('click', function() {
                        selectDate(date, this);
                    });
                    
                    button.innerHTML = `
                        <div class="text-sm font-medium">
                            ${dateObj.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' })}
                        </div>
                        <div class="text-xs text-gray-500">
                            ${dateObj.toLocaleDateString('zh-CN', { weekday: 'short' })}
                        </div>
                    `;
                    dateGrid.appendChild(button);
                }
            });
        }

        // é€‰æ‹©æ—¥æœŸ
        function selectDate(date, button) {
            document.querySelectorAll('#dateGrid button').forEach(btn => {
                btn.className = 'p-3 rounded-lg border-2 transition-all hover:scale-105 border-gray-200 hover:border-blue-300 hover:bg-blue-50 bg-white';
            });

            button.className = 'p-3 rounded-lg border-2 transition-all hover:scale-105 border-orange-500 bg-orange-50 text-orange-700';
            appData.selectedDate = date;
            appData.selectedTimeSlot = '';
            
            generateTimeSlotGrid();
            document.getElementById('timeSlotSection').style.display = 'block';
            updateSubmitButton();
        }

        // ç”Ÿæˆæ—¶é—´æ®µç½‘æ ¼
        function generateTimeSlotGrid() {
            const timeSlots = ['10:00-11:30', '11:30-13:00', '13:00-14:30'];
            const timeSlotGrid = document.getElementById('timeSlotGrid');
            timeSlotGrid.innerHTML = '';

            timeSlots.forEach(timeSlot => {
                const isBooked = isTimeSlotBooked(appData.selectedDate, timeSlot);
                const button = document.createElement('button');
                button.type = 'button';
                
                if (isBooked) {
                    button.className = 'time-slot-booked p-4 rounded-lg font-medium transition-all';
                    button.disabled = true;
                    button.innerHTML = `
                        <div class="text-lg">${timeSlot}</div>
                        <div class="text-sm mt-1">å·²é¢„çº¦ | Booked</div>
                    `;
                } else {
                    button.className = 'time-slot-available p-4 rounded-lg font-medium transition-all';
                    button.addEventListener('click', function() {
                        selectTimeSlot(timeSlot, this);
                    });
                    button.innerHTML = `
                        <div class="text-lg">${timeSlot}</div>
                        <div class="text-sm mt-1">å¯é¢„çº¦ | Available</div>
                    `;
                }
                
                timeSlotGrid.appendChild(button);
            });
        }

        // é€‰æ‹©æ—¶é—´æ®µ
        function selectTimeSlot(timeSlot, button) {
            document.querySelectorAll('#timeSlotGrid button:not(:disabled)').forEach(btn => {
                btn.className = 'time-slot-available p-4 rounded-lg font-medium transition-all';
                btn.innerHTML = btn.innerHTML.replace('å·²é€‰æ‹© | Selected', 'å¯é¢„çº¦ | Available');
            });

            button.className = 'time-slot-selected p-4 rounded-lg font-medium transition-all';
            button.innerHTML = `
                <div class="text-lg">${timeSlot}</div>
                <div class="text-sm mt-1">å·²é€‰æ‹© | Selected</div>
            `;
            
            appData.selectedTimeSlot = timeSlot;
            updateSubmitButton();
        }

        // æ›´æ–°æäº¤æŒ‰é’®
        function updateSubmitButton() {
            const submitBtn = document.getElementById('submitBtn');
            if (appData.selectedDate && appData.selectedTimeSlot) {
                submitBtn.disabled = false;
                submitBtn.className = 'btn-primary text-white px-6 sm:px-8 py-3 rounded-lg font-semibold';
            } else {
                submitBtn.disabled = true;
                submitBtn.className = 'btn-primary text-white px-6 sm:px-8 py-3 rounded-lg font-semibold opacity-50 cursor-not-allowed';
            }
        }

        // æäº¤é¢„çº¦
        async function submitBooking() {
            const orderNum = appData.nextOrderNumber.toString().padStart(3, '0');
            const newOrderNumber = `INV-JOYA-${orderNum}`;
            appData.nextOrderNumber++;

            let keyArrangement = document.getElementById('keyArrangement').value;
            if (keyArrangement === 'Other | å…¶ä»–') {
                keyArrangement = 'Other | å…¶ä»–ï¼š' + document.getElementById('keyOtherDetails').value;
            }

            const newBooking = {
                id: Date.now(),
                orderNumber: newOrderNumber,
                customerName: document.getElementById('customerName').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                address: document.getElementById('address').value,
                postcode: document.getElementById('postcode').value,
                serviceType: document.getElementById('serviceType').value,
                preferredDate: appData.selectedDate,
                preferredTimeSlot: appData.selectedTimeSlot,
                keyArrangement: keyArrangement,
                specialRequirements: document.getElementById('specialRequirements').value,
                notes: document.getElementById('notes').value,
                status: 'pending',
                createdAt: new Date().toISOString()
            };

            appData.bookings.push(newBooking);
            await saveData();
            
            document.getElementById('orderNumber').textContent = newOrderNumber;
            document.getElementById('bookingDetails').innerHTML = `
                <p><strong>Name | å§“åï¼š</strong>${newBooking.customerName}</p>
                <p><strong>Phone | è”ç³»æ–¹å¼ï¼š</strong>${newBooking.phone}</p>
                <p><strong>Service Type | æœåŠ¡ç±»å‹ï¼š</strong>${newBooking.serviceType}</p>
                <p><strong>Date | é¢„çº¦æ—¥æœŸï¼š</strong>${newBooking.preferredDate}</p>
                <p><strong>Time | é¢„çº¦æ—¶é—´ï¼š</strong>${newBooking.preferredTimeSlot}</p>
                <p><strong>Key Arrangement | é’¥åŒ™å®‰æ’ï¼š</strong>${newBooking.keyArrangement}</p>
            `;
            
            showStep(3);
        }

        // é‡ç½®è¡¨å•
        function resetForm() {
            const fields = ['customerName', 'phone', 'email', 'address', 'postcode', 'specialRequirements', 'notes', 'keyOtherDetails'];
            fields.forEach(field => {
                if (document.getElementById(field)) {
                    document.getElementById(field).value = '';
                }
            });
            
            document.getElementById('serviceType').selectedIndex = 0;
            document.getElementById('keyArrangement').selectedIndex = 0;
            document.getElementById('keyOtherSection').style.display = 'none';
            
            appData.selectedDate = '';
            appData.selectedTimeSlot = '';
            document.getElementById('timeSlotSection').style.display = 'none';
            
            showStep(1);
        }

        // ç¡®è®¤é¢„çº¦
        async function confirmBooking(bookingId) {
            const booking = appData.bookings.find(b => b.id === bookingId);
            if (booking) {
                console.log('ğŸ”„ æ­£åœ¨ç¡®è®¤è®¢å•:', booking.orderNumber);
                booking.status = 'confirmed';
                booking.confirmedDate = booking.preferredDate;
                booking.confirmedTimeSlot = booking.preferredTimeSlot;
                await saveData();
                loadOrdersList();
                generateCalendar();
                console.log('âœ… è®¢å•ç¡®è®¤å®Œæˆï¼Œå·²åŒæ­¥åˆ°äº‘ç«¯');
                await sendConfirmationEmail(booking, false);
            }
        }

        // å–æ¶ˆé¢„çº¦
        async function cancelBooking(bookingId) {
            if (confirm('Are you sure you want to cancel this booking? | ç¡®å®šè¦å–æ¶ˆè¿™ä¸ªé¢„çº¦å—ï¼Ÿ')) {
                const booking = appData.bookings.find(b => b.id === bookingId);
                if (booking) {
                    console.log('ğŸ”„ æ­£åœ¨å–æ¶ˆè®¢å•:', booking.orderNumber);
                    booking.status = 'cancelled';
                    await saveData();
                    loadOrdersList();
                    generateCalendar();
                    console.log('âœ… è®¢å•å–æ¶ˆå®Œæˆï¼Œå·²åŒæ­¥åˆ°äº‘ç«¯');
                    await sendCancellationEmail(booking);
                }
            }
        }

        // åˆ é™¤é¢„çº¦
        async function deleteBooking(bookingId) {
            if (confirm('Are you sure you want to delete this booking? This action cannot be undone. | ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé¢„çº¦å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚')) {
                const bookingIndex = appData.bookings.findIndex(b => b.id === bookingId);
                if (bookingIndex !== -1) {
                    const booking = appData.bookings[bookingIndex];
                    console.log('ğŸ”„ æ­£åœ¨åˆ é™¤è®¢å•:', booking.orderNumber);
                    appData.bookings.splice(bookingIndex, 1);
                    await saveData();
                    loadOrdersList();
                    generateCalendar();
                    console.log('âœ… è®¢å•åˆ é™¤å®Œæˆï¼Œå·²åŒæ­¥åˆ°äº‘ç«¯');
                    alert('Booking deleted successfully. | é¢„çº¦å·²æˆåŠŸåˆ é™¤ã€‚');
                }
            }
        }

        // å‘é€ç¡®è®¤é‚®ä»¶
        async function sendConfirmationEmail(booking, isModification = false) {
            const subject = isModification ? 
                `Booking Time Modified | é¢„çº¦æ—¶é—´å·²ä¿®æ”¹ - ${booking.orderNumber}` : 
                `Booking Confirmed | é¢„çº¦å·²ç¡®è®¤ - ${booking.orderNumber}`;

            console.log('ğŸš€ å¼€å§‹å‘é€é‚®ä»¶...', { to: booking.email, subject: subject });

            try {
                const response = await fetch('/api/send-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        to: booking.email,
                        subject: subject,
                        bookingData: {
                            type: 'confirmation',
                            booking: booking,
                            isModification: isModification
                        }
                    })
                });

                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    const result = await response.json();
                    if (response.ok && result.success) {
                        alert(`âœ… ${isModification ? 'Modification notification' : 'Confirmation'} email sent successfully!`);
                    } else {
                        throw new Error(`API Error: ${result.error || 'Unknown error'}`);
                    }
                } else {
                    const text = await response.text();
                    console.error('âŒ éJSONå“åº”:', text.substring(0, 200));
                    throw new Error(`APIè¿”å›éJSONå“åº” (çŠ¶æ€: ${response.status})`);
                }
            } catch (error) {
                console.error('âŒ é‚®ä»¶å‘é€å¤±è´¥:', error);
                alert(`âŒ Failed to send email: ${error.message}\n\nThe booking is still saved successfully.`);
            }
        }

        // å‘é€å–æ¶ˆé‚®ä»¶
        async function sendCancellationEmail(booking) {
            try {
                const response = await fetch('/api/send-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        to: booking.email,
                        subject: `Booking Cancelled | é¢„çº¦å·²å–æ¶ˆ - ${booking.orderNumber}`,
                        bookingData: {
                            type: 'cancellation',
                            booking: booking,
                            isModification: false
                        }
                    })
                });

                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    const result = await response.json();
                    if (response.ok && result.success) {
                        alert(`âœ… Cancellation email sent successfully!`);
                    } else {
                        throw new Error(result.error || 'Failed to send email');
                    }
                } else {
                    throw new Error(`APIè¿”å›éJSONå“åº”`);
                }
            } catch (error) {
                console.error('âŒ å–æ¶ˆé‚®ä»¶å‘é€å¤±è´¥:', error);
                alert(`âŒ Failed to send cancellation email: ${error.message}\n\nThe booking cancellation is still saved.`);
            }
        }

        // ç”Ÿæˆæ—¥å†
        function generateCalendar() {
            const year = appData.currentCalendarDate.getFullYear();
            const month = appData.currentCalendarDate.getMonth();
            
            document.getElementById('currentMonthYear').textContent = 
                `${year}å¹´${month + 1}æœˆ | ${year}-${(month + 1).toString().padStart(2, '0')}`;
            
            const firstDay = new Date(year, month, 1);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';
            
            const weekDays = ['Sun | æ—¥', 'Mon | ä¸€', 'Tue | äºŒ', 'Wed | ä¸‰', 'Thu | å››', 'Fri | äº”', 'Sat | å…­'];
            weekDays.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'text-center font-semibold text-gray-600 p-2 text-xs';
                dayHeader.textContent = day;
                calendarGrid.appendChild(dayHeader);
            });
            
            for (let i = 0; i < 42; i++) {
                const currentDate = new Date(startDate);
                currentDate.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                const dateString = currentDate.toISOString().split('T')[0];
                
                dayElement.className = 'relative p-2 text-center border border-gray-100 rounded min-h-[60px] flex flex-col justify-center cursor-pointer transition-all hover:bg-gray-50';
                dayElement.setAttribute('data-date', dateString);
                
                const isCurrentMonth = currentDate.getMonth() === month;
                const hasBookings = appData.bookings.some(booking => 
                    booking.preferredDate === dateString && booking.status === 'confirmed'
                );
                
                const isSelected = appData.selectedCalendarDate === dateString;
                
                if (isCurrentMonth) {
                    if (isSelected) {
                        dayElement.className += ' calendar-day-selected bg-orange-200 border-orange-400 text-gray-900';
                    } else {
                        dayElement.className += ' bg-white text-gray-900';
                        if (hasBookings) {
                            dayElement.className += ' bg-blue-100 border-blue-300';
                        }
                    }
                    dayElement.addEventListener('click', () => handleCalendarDayClick(dateString));
                } else {
                    dayElement.className += ' bg-gray-50 text-gray-400 cursor-default';
                }
                
                dayElement.innerHTML = `
                    <div class="text-sm font-medium">${currentDate.getDate()}</div>
                    ${hasBookings ? '<div class="w-2 h-2 bg-blue-500 rounded-full mx-auto mt-1"></div>' : ''}
                `;
                
                calendarGrid.appendChild(dayElement);
            }
        }

        // æ—¥å†ç‚¹å‡»å¤„ç†
        function handleCalendarDayClick(dateString) {
            const showAllBtn = document.getElementById('showAllOrdersBtn');
            
            if (appData.selectedCalendarDate === dateString) {
                appData.selectedCalendarDate = null;
                appData.showAllOrders = true;
                showAllBtn.style.display = 'none';
                generateCalendar();
            } else {
                appData.selectedCalendarDate = dateString;
                appData.showAllOrders = false;
                showAllBtn.style.display = 'block';
                generateCalendar();
            }
            
            loadOrdersList();
        }

        // ç®¡ç†å‘˜æ ‡ç­¾é¡µåˆ‡æ¢
        function showOrdersTab() {
            document.getElementById('ordersTab').style.display = 'block';
            document.getElementById('settingsTab').style.display = 'none';
            document.getElementById('ordersTabBtn').className = 'flex-1 py-3 px-4 rounded-md font-medium transition-all nav-active';
            document.getElementById('settingsTabBtn').className = 'flex-1 py-3 px-4 rounded-md font-medium transition-all nav-inactive';
            loadOrdersList();
        }

        function showSettingsTab() {
            document.getElementById('ordersTab').style.display = 'none';
            document.getElementById('settingsTab').style.display = 'block';
            document.getElementById('ordersTabBtn').className = 'flex-1 py-3 px-4 rounded-md font-medium transition-all nav-inactive';
            document.getElementById('settingsTabBtn').className = 'flex-1 py-3 px-4 rounded-md font-medium transition-all nav-active';
            
            document.getElementById('welcomeMessageInput').value = appData.settings.welcomeMessage;
            document.getElementById('noticeMessageInput').value = appData.settings.noticeMessage;
            document.getElementById('afterSubmitNoticeInput').value = appData.settings.afterSubmitNotice;
            updateStats();
        }

        // åŠ è½½è®¢å•åˆ—è¡¨
        function loadOrdersList() {
            const ordersList = document.getElementById('ordersList');
            
            let filteredBookings = appData.bookings;
            if (!appData.showAllOrders && appData.selectedCalendarDate) {
                filteredBookings = appData.bookings.filter(booking => 
                    booking.preferredDate === appData.selectedCalendarDate
                );
            }
            
            if (filteredBookings.length === 0) {
                const message = appData.showAllOrders ? 
                    'No orders found | æš‚æ— è®¢å•' : 
                    'No orders for selected date | æ‰€é€‰æ—¥æœŸæ— è®¢å•';
                ordersList.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-4xl mb-4">ğŸ“‹</div>
                        <p class="text-gray-500">${message}</p>
                    </div>
                `;
                return;
            }

            ordersList.innerHTML = filteredBookings.slice().reverse().map(booking => `
                <div class="admin-bg rounded-lg p-4 mb-4 card-hover border border-gray-200">
                    <div class="flex flex-col sm:flex-row justify-between items-start mb-3">
                        <div>
                            <h4 class="font-bold text-lg text-blue-900">${booking.orderNumber}</h4>
                            <p class="text-gray-600">${booking.customerName} â€¢ ${booking.phone}</p>
                        </div>
                        <span class="mt-2 sm:mt-0 px-3 py-1 rounded-full text-xs font-medium ${getStatusBadgeClass(booking.status)}">
                            ${getStatusLabel(booking.status)}
                        </span>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
                        <div>
                            <p class="text-gray-700"><strong>Service Type | æœåŠ¡ç±»å‹ï¼š</strong>${booking.serviceType}</p>
                            <p class="text-gray-700"><strong>Date & Time | é¢„çº¦æ—¶é—´ï¼š</strong>${booking.preferredDate} ${booking.preferredTimeSlot}</p>
                            <p class="text-gray-700"><strong>Key Arrangement | é’¥åŒ™å®‰æ’ï¼š</strong>${booking.keyArrangement}</p>
                        </div>
                        <div>
                            <p class="text-gray-700"><strong>Address | åœ°å€ï¼š</strong>${booking.address}</p>
                            <p class="text-gray-700"><strong>Email | é‚®ç®±ï¼š</strong>${booking.email}</p>
                        </div>
                    </div>

                    ${booking.notes ? `
                        <div class="mb-4">
                            <p class="text-gray-700"><strong>Notes | å¤‡æ³¨ï¼š</strong></p>
                            <p class="text-gray-600 bg-gray-100 p-2 rounded">${booking.notes}</p>
                        </div>
                    ` : ''}

                    <div class="flex flex-col sm:flex-row gap-2">
                        ${booking.status === 'pending' ? `
                            <button data-booking-id="${booking.id}" class="confirm-btn btn-primary text-white px-4 py-2 rounded-lg text-sm">
                                Confirm | ç¡®è®¤é¢„çº¦
                            </button>
                        ` : ''}
                        
                        ${booking.status === 'confirmed' ? `
                            <button data-booking-id="${booking.id}" class="modify-btn btn-secondary text-white px-4 py-2 rounded-lg text-sm">
                                Modify Time | ä¿®æ”¹æ—¶é—´
                            </button>
                        ` : ''}
                        
                        <button data-booking-id="${booking.id}" class="cancel-btn bg-red-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-red-600 transition-all">
                            Cancel | å–æ¶ˆ
                        </button>
                        
                        <button data-booking-id="${booking.id}" class="delete-btn bg-gray-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-gray-600 transition-all">
                            Delete | åˆ é™¤
                        </button>
                    </div>
                </div>
            `).join('');
            
            bindOrderButtons();
        }

        // ç»‘å®šè®¢å•æŒ‰é’®äº‹ä»¶
        function bindOrderButtons() {
            document.querySelectorAll('.confirm-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const bookingId = parseInt(this.dataset.bookingId);
                    confirmBooking(bookingId);
                });
            });
            
            document.querySelectorAll('.cancel-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const bookingId = parseInt(this.dataset.bookingId);
                    cancelBooking(bookingId);
                });
            });

            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const bookingId = parseInt(this.dataset.bookingId);
                    deleteBooking(bookingId);
                });
            });

            document.querySelectorAll('.modify-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const bookingId = parseInt(this.dataset.bookingId);
                    showModifyModal(bookingId);
                });
            });
        }

        // æ˜¾ç¤ºä¿®æ”¹æ—¶é—´å¼¹çª—
        function showModifyModal(bookingId) {
            const booking = appData.bookings.find(b => b.id === bookingId);
            if (!booking) return;

            appData.currentModifyingBookingId = bookingId;
            
            document.getElementById('newDate').value = booking.preferredDate;
            document.getElementById('newTimeSlot').value = booking.preferredTimeSlot;
            
            document.getElementById('modifyModal').style.display = 'flex';
        }

        // éšè—ä¿®æ”¹å¼¹çª—
        function hideModifyModal() {
            document.getElementById('modifyModal').style.display = 'none';
            appData.currentModifyingBookingId = null;
        }

        // ç¡®è®¤ä¿®æ”¹æ—¶é—´
        async function confirmModifyTime() {
            const newDate = document.getElementById('newDate').value;
            const newTimeSlot = document.getElementById('newTimeSlot').value;
            
            if (!newDate || !newTimeSlot) {
                alert('Please fill in all fields | è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
                return;
            }

            const booking = appData.bookings.find(b => b.id === appData.currentModifyingBookingId);
            if (!booking) return;

            const isConflict = appData.bookings.some(b => 
                b.id !== appData.currentModifyingBookingId && 
                b.preferredDate === newDate && 
                b.preferredTimeSlot === newTimeSlot && 
                b.status === 'confirmed'
            );

            if (isConflict) {
                alert('Time slot conflict! Please choose another time. | æ—¶é—´å†²çªï¼è¯·é€‰æ‹©å…¶ä»–æ—¶é—´ã€‚');
                return;
            }

            console.log('ğŸ”„ æ­£åœ¨ä¿®æ”¹è®¢å•æ—¶é—´:', booking.orderNumber);
            
            booking.preferredDate = newDate;
            booking.preferredTimeSlot = newTimeSlot;
            booking.confirmedDate = newDate;
            booking.confirmedTimeSlot = newTimeSlot;
            
            await saveData();
            
            hideModifyModal();
            loadOrdersList();
            generateCalendar();
            
            console.log('âœ… æ—¶é—´ä¿®æ”¹å®Œæˆï¼Œå·²åŒæ­¥åˆ°äº‘ç«¯');
            
            await sendConfirmationEmail(booking, true);
        }

        // è·å–çŠ¶æ€æ ·å¼ç±»
        function getStatusBadgeClass(status) {
            const classes = {
                pending: 'bg-yellow-100 text-yellow-800',
                confirmed: 'bg-green-100 text-green-800',
                completed: 'bg-blue-100 text-blue-800',
                cancelled: 'bg-gray-100 text-gray-800'
            };
            return classes[status] || classes.pending;
        }

        // è·å–çŠ¶æ€æ ‡ç­¾
        function getStatusLabel(status) {
            const labels = {
                pending: 'Pending | å¾…ç¡®è®¤',
                confirmed: 'Confirmed | å·²ç¡®è®¤',
                completed: 'Completed | å·²å®Œæˆ',
                cancelled: 'Cancelled | å·²å–æ¶ˆ'
            };
            return labels[status] || 'Pending | å¾…ç¡®è®¤';
        }

        // æ›´æ–°è®¾ç½®
        async function updateSettings() {
            appData.settings.welcomeMessage = document.getElementById('welcomeMessageInput').value;
            appData.settings.noticeMessage = document.getElementById('noticeMessageInput').value;
            appData.settings.afterSubmitNotice = document.getElementById('afterSubmitNoticeInput').value;
            
            await saveData();
            
            const welcomeParagraphs = document.querySelectorAll('#welcomeText');
            if (welcomeParagraphs.length > 0) {
                welcomeParagraphs[0].textContent = appData.settings.welcomeMessage;
            }
            document.getElementById('noticeText').textContent = appData.settings.noticeMessage;
            document.getElementById('afterSubmitNotice').textContent = appData.settings.afterSubmitNotice;
            
            alert('Settings saved successfully! | è®¾ç½®å·²ä¿å­˜ï¼');
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStats() {
            const statsGrid = document.getElementById('statsGrid');
            const totalBookings = appData.bookings.length;
            const pendingBookings = appData.bookings.filter(b => b.status === 'pending').length;
            const confirmedBookings = appData.bookings.filter(b => b.status === 'confirmed').length;
            const completedBookings = appData.bookings.filter(b => b.status === 'completed').length;

            statsGrid.innerHTML = `
                <div class="bg-white p-3 rounded-lg border border-gray-200">
                    <div class="text-2xl font-bold text-blue-900">${totalBookings}</div>
                    <div class="text-sm text-blue-700">Total | æ€»è®¢å•</div>
                </div>
                <div class="bg-white p-3 rounded-lg border border-gray-200">
                    <div class="text-2xl font-bold text-yellow-600">${pendingBookings}</div>
                    <div class="text-sm text-yellow-700">Pending | å¾…ç¡®è®¤</div>
                </div>
                <div class="bg-white p-3 rounded-lg border border-gray-200">
                    <div class="text-2xl font-bold text-green-600">${confirmedBookings}</div>
                    <div class="text-sm text-green-700">Confirmed | å·²ç¡®è®¤</div>
                </div>
                <div class="bg-white p-3 rounded-lg border border-gray-200">
                    <div class="text-2xl font-bold text-blue-600">${completedBookings}</div>
                    <div class="text-sm text-blue-700">Completed | å·²å®Œæˆ</div>
                </div>
            `;
        }

        // äº‹ä»¶ç»‘å®š
        function bindEvents() {
            const customerTab = document.getElementById('customerTab');
            const adminTab = document.getElementById('adminTab');
            const nextStepBtn = document.getElementById('nextStepBtn');
            const prevStepBtn = document.getElementById('prevStepBtn');
            const submitBtn = document.getElementById('submitBtn');
            const resetBtn = document.getElementById('resetBtn');
            const keyArrangement = document.getElementById('keyArrangement');
            const prevMonth = document.getElementById('prevMonth');
            const nextMonth = document.getElementById('nextMonth');
            const ordersTabBtn = document.getElementById('ordersTabBtn');
            const settingsTabBtn = document.getElementById('settingsTabBtn');
            const saveSettingsBtn = document.getElementById('saveSettingsBtn');
            const showAllOrdersBtn = document.getElementById('showAllOrdersBtn');
            const cancelModify = document.getElementById('cancelModify');
            const confirmModify = document.getElementById('confirmModify');
            const modifyModal = document.getElementById('modifyModal');

            if (customerTab) {
                customerTab.addEventListener('click', showCustomerView);
            }
            if (adminTab) {
                adminTab.addEventListener('click', showAdminView);
            }

            if (nextStepBtn) {
                nextStepBtn.addEventListener('click', function() {
                    if (validateStep1()) {
                        showStep(2);
                        generateDateGrid();
                    }
                });
            }

            if (prevStepBtn) {
                prevStepBtn.addEventListener('click', function() {
                    showStep(1);
                });
            }

            if (submitBtn) {
                submitBtn.addEventListener('click', submitBooking);
            }

            if (resetBtn) {
                resetBtn.addEventListener('click', resetForm);
            }

            if (keyArrangement) {
                keyArrangement.addEventListener('change', function() {
                    const keyOtherSection = document.getElementById('keyOtherSection');
                    if (this.value === 'Other | å…¶ä»–') {
                        keyOtherSection.style.display = 'block';
                    } else {
                        keyOtherSection.style.display = 'none';
                        const keyOtherDetails = document.getElementById('keyOtherDetails');
                        if (keyOtherDetails) {
                            keyOtherDetails.value = '';
                        }
                    }
                });
            }

            if (prevMonth) {
                prevMonth.addEventListener('click', function() {
                    appData.currentCalendarDate.setMonth(appData.currentCalendarDate.getMonth() - 1);
                    generateCalendar();
                });
            }

            if (nextMonth) {
                nextMonth.addEventListener('click', function() {
                    appData.currentCalendarDate.setMonth(appData.currentCalendarDate.getMonth() + 1);
                    generateCalendar();
                });
            }

            if (ordersTabBtn) {
                ordersTabBtn.addEventListener('click', showOrdersTab);
            }

            if (settingsTabBtn) {
                settingsTabBtn.addEventListener('click', showSettingsTab);
            }

            if (saveSettingsBtn) {
                saveSettingsBtn.addEventListener('click', updateSettings);
            }

            if (showAllOrdersBtn) {
                showAllOrdersBtn.addEventListener('click', function() {
                    appData.selectedCalendarDate = null;
                    appData.showAllOrders = true;
                    this.style.display = 'none';
                    generateCalendar();
                    loadOrdersList();
                });
            }

            if (cancelModify) {
                cancelModify.addEventListener('click', hideModifyModal);
            }

            if (confirmModify) {
                confirmModify.addEventListener('click', confirmModifyTime);
            }

            if (modifyModal) {
                modifyModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        hideModifyModal();
                    }
                });
            }
        }

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
            
            setTimeout(async function() {
                try {
                    await loadData();
                    
                    bindEvents();
                    showCustomerView();
                    
                    const serviceType = document.getElementById('serviceType');
                    const keyArrangement = document.getElementById('keyArrangement');
                    
                    if (serviceType) {
                        serviceType.selectedIndex = 0;
                    }
                    if (keyArrangement) {
                        keyArrangement.selectedIndex = 0;
                    }
                    
                    console.log('ğŸ‰ åˆå§‹åŒ–å®Œæˆï¼äº‘ç«¯æ•°æ®å·²åŠ è½½');
                    
                    if (appData.bookings.length > 0) {
                        console.log(`ğŸ“Š ç³»ç»Ÿä¸­æœ‰ ${appData.bookings.length} ä¸ªè®¢å•`);
                    }
                    
                } catch (error) {
                    console.error('âŒ åˆå§‹åŒ–æ—¶å‡ºé”™:', error);
                    setTimeout(function() {
                        bindEvents();
                        showCustomerView();
                        alert('âš ï¸ åˆå§‹åŒ–æ—¶é‡åˆ°é—®é¢˜ï¼Œå·²åˆ‡æ¢åˆ°ç¦»çº¿æ¨¡å¼ã€‚åŠŸèƒ½å¯èƒ½å—é™ã€‚');
                    }, 1000);
                }
            }, 100);
        });
    </script>
</body>
</html><!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property Inspection Booking System | æˆ¿äº§æ£€æŸ¥é¢„çº¦ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 30%, #f59e0b 70%, #fbbf24 100%);
            min-height: 100vh;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .btn-primary {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(30, 58, 138, 0.4);
        }
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.5);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
        }
        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.5);
        }
        .nav-active {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(30, 58, 138, 0.4);
        }
        .nav-inactive {
            background: rgba(255, 255, 255, 0.2);
            color: #1f2937;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .nav-inactive:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }
        .time-slot-available {
            background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        .time-slot-available:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }
        .time-slot-booked {
            background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
            color: #374151;
            cursor: not-allowed;
        }
        .time-slot-selected {
            background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
            transform: scale(1.05);
        }
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .gradient-text {
            background: linear-gradient(135deg, #1e3a8a 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .admin-bg {
            background: rgba(248, 250, 252, 0.95);
        }
        .calendar-day-selected {
            background-color: #fed7aa !important;
            border-color: #fb923c !important;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="glass-effect sticky top-0 z-50 mb-6">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col sm:flex-row justify-between items-center h-auto sm:h-16 py-4 sm:py-0">
                <div class="flex items-center mb-4 sm:mb-0">
                    <h1 class="text-xl sm:text-2xl font-bold gradient-text">ğŸ  Property Inspection Booking | æˆ¿äº§æ£€æŸ¥é¢„çº¦ç³»ç»Ÿ</h1>
                </div>
                <div class="flex space-x-3">
                    <button id="customerTab" class="nav-active px-4 py-2 rounded-lg font-semibold transition-all">
                        Customer Booking<br>å®¢æˆ·é¢„çº¦
                    </button>
                    <button id="adminTab" class="nav-inactive px-4 py-2 rounded-lg font-semibold transition-all">
                        Admin Panel<br>åå°ç®¡ç†
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- å®¢æˆ·é¢„çº¦è§†å›¾ -->
        <div id="customerView">
            <!-- æ¬¢è¿åŒºåŸŸ -->
            <div class="text-center mb-8 fade-in">
                <div class="glass-effect p-6 sm:p-8 rounded-2xl shadow-xl card-hover">
                    <h2 class="text-2xl sm:text-4xl font-bold mb-4 gradient-text">âœ¨ Professional Property Inspection Service</h2>
                    <h2 class="text-2xl sm:text-4xl font-bold mb-4 gradient-text">ä¸“ä¸šæˆ¿äº§æ£€æŸ¥æœåŠ¡</h2>
                    <p id="welcomeText" class="text-lg sm:text-xl text-gray-700 leading-relaxed">
                        Welcome to our property inspection booking system! We provide professional and caring property inspection services.
                    </p>
                    <p class="text-lg sm:text-xl text-gray-700 leading-relaxed mt-2">
                        æ¬¢è¿ä½¿ç”¨æˆ¿äº§æ£€æŸ¥é¢„çº¦ç³»ç»Ÿï¼æˆ‘ä»¬æä¾›ä¸“ä¸šã€è´´å¿ƒçš„æˆ¿äº§æ£€æŸ¥æœåŠ¡ã€‚
                    </p>
                </div>
            </div>

            <!-- æ­¥éª¤1ï¼šåŸºæœ¬ä¿¡æ¯ -->
            <div id="step1">
                <div class="glass-effect rounded-2xl p-6 sm:p-8 shadow-xl card-hover">
                    <h3 class="text-xl sm:text-2xl font-bold mb-2 gradient-text">ğŸ“ Basic Information</h3>
                    <h3 class="text-xl sm:text-2xl font-bold mb-6 gradient-text">åŸºæœ¬ä¿¡æ¯</h3>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Full Name | å§“å <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="customerName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Please enter your full name | è¯·è¾“å…¥æ‚¨çš„å§“å">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Phone Number | æ‰‹æœºå· <span class="text-red-500">*</span>
                            </label>
                            <input type="tel" id="phone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Please enter your phone number | è¯·è¾“å…¥æ‰‹æœºå·">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Email Address | é‚®ç®± <span class="text-red-500">*</span>
                            </label>
                            <input type="email" id="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Please enter your email address | è¯·è¾“å…¥é‚®ç®±åœ°å€">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Postcode | é‚®ç¼–
                            </label>
                            <input type="text" id="postcode" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Please enter postcode | è¯·è¾“å…¥é‚®ç¼–">
                        </div>

                        <div class="lg:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Property Address | æˆ¿äº§åœ°å€ <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="address" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Please enter detailed address | è¯·è¾“å…¥è¯¦ç»†åœ°å€">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Service Type | æœåŠ¡ç±»å‹ <span class="text-red-500">*</span>
                            </label>
                            <select id="serviceType" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                <option value="Mid-term Inspection | æœŸä¸­æ£€æŸ¥">Mid-term Inspection | æœŸä¸­æ£€æŸ¥</option>
                                <option value="Final Inspection | æœŸæœ«æ£€æŸ¥">Final Inspection | æœŸæœ«æ£€æŸ¥</option>
                                <option value="Property Viewing | å®åœ°çœ‹æˆ¿">Property Viewing | å®åœ°çœ‹æˆ¿</option>
                                <option value="Virtual Viewing | è¿çº¿çœ‹æˆ¿">Virtual Viewing | è¿çº¿çœ‹æˆ¿</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Key Arrangement | é’¥åŒ™å®‰æ’ <span class="text-red-500">*</span>
                            </label>
                            <select id="keyArrangement" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                <option value="Customer Keeps | å®¢æˆ·ä¿ç•™">Customer Keeps | å®¢æˆ·ä¿ç•™</option>
                                <option value="Handover to Inspector | äº¤ç»™æ£€æŸ¥å‘˜">Handover to Inspector | äº¤ç»™æ£€æŸ¥å‘˜</option>
                                <option value="Other | å…¶ä»–">Other | å…¶ä»–</option>
                            </select>
                        </div>

                        <!-- é’¥åŒ™å®‰æ’å…¶ä»–é€‰é¡¹çš„è¯´æ˜ -->
                        <div id="keyOtherSection" style="display: none;" class="lg:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Key Arrangement Details | é’¥åŒ™å®‰æ’è¯´æ˜ <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="keyOtherDetails" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Please specify the key arrangement details | è¯·è¯¦ç»†è¯´æ˜é’¥åŒ™çš„å…·ä½“å®‰æ’">
                        </div>
                    </div>

                    <div class="mt-8 text-center">
                        <button id="nextStepBtn" class="btn-primary text-white px-6 sm:px-8 py-3 sm:py-4 rounded-lg font-semibold text-lg">
                            Next: Select Time<br>ä¸‹ä¸€æ­¥ï¼šé€‰æ‹©æ—¶é—´ â†’
                        </button>
                    </div>
                </div>
            </div>

            <!-- æ­¥éª¤2ï¼šé€‰æ‹©æ—¶é—´ -->
            <div id="step2" style="display: none;">
                <div class="glass-effect rounded-2xl p-6 sm:p-8 shadow-xl card-hover fade-in">
                    <h3 class="text-xl sm:text-2xl font-bold mb-2 gradient-text">ğŸ“… Select Appointment Time</h3>
                    <h3 class="text-xl sm:text-2xl font-bold mb-6 gradient-text">é€‰æ‹©é¢„çº¦æ—¶é—´</h3>
                    
                    <div class="mb-8">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Select Date <span class="text-red-500">*</span>
                        </label>
                        <label class="block text-sm font-medium text-gray-700 mb-4">
                            é€‰æ‹©æ—¥æœŸ <span class="text-red-500">*</span>
                        </label>
                        <div id="dateGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3">
                            <!-- æ—¥æœŸé€‰é¡¹ -->
                        </div>
                    </div>

                    <div id="timeSlotSection" style="display: none;" class="mb-8">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Select Time Slot <span class="text-red-500">*</span>
                        </label>
                        <label class="block text-sm font-medium text-gray-700 mb-4">
                            é€‰æ‹©æ—¶é—´æ®µ <span class="text-red-500">*</span>
                        </label>
                        <div id="timeSlotGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                            <!-- æ—¶é—´æ®µé€‰é¡¹ -->
                        </div>
                        
                        <div class="mt-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Other Time Requirements
                            </label>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                å…¶ä»–æ—¶é—´éœ€æ±‚ï¼ˆéæ ‡å‡†æ—¶æ®µï¼‰
                            </label>
                            <textarea id="specialRequirements" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" rows="3" placeholder="If you need other time arrangements, please specify here | å¦‚éœ€å…¶ä»–æ—¶é—´å®‰æ’ï¼Œè¯·åœ¨æ­¤è¯´æ˜ï¼ˆä¸ä¿è¯èƒ½æ»¡è¶³ï¼‰"></textarea>
                        </div>
                    </div>

                    <div class="mb-8">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Notes
                        </label>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            å¤‡æ³¨
                        </label>
                        <textarea id="notes" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" rows="3" placeholder="If you have other matters to explain, please fill in here | å¦‚æœ‰å…¶ä»–éœ€è¦è¯´æ˜çš„äº‹é¡¹ï¼Œè¯·åœ¨æ­¤å¡«å†™"></textarea>
                    </div>

                    <div class="flex flex-col sm:flex-row justify-between gap-4">
                        <button id="prevStepBtn" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all">
                            â† Previous | ä¸Šä¸€æ­¥
                        </button>
                        <button id="submitBtn" class="btn-primary text-white px-6 sm:px-8 py-3 rounded-lg font-semibold opacity-50 cursor-not-allowed" disabled>
                            Submit Booking | æäº¤é¢„çº¦
                        </button>
                    </div>
                </div>
            </div>

            <!-- æ­¥éª¤3ï¼šç¡®è®¤é¡µé¢ -->
            <div id="step3" style="display: none;">
                <div class="glass-effect rounded-2xl p-6 sm:p-8 shadow-xl text-center card-hover fade-in">
                    <div class="text-4xl sm:text-6xl mb-6">âœ…</div>
                    <h2 class="text-2xl sm:text-3xl font-bold text-green-600 mb-2">Booking Submitted Successfully!</h2>
                    <h2 class="text-2xl sm:text-3xl font-bold text-green-600 mb-4">é¢„çº¦æäº¤æˆåŠŸï¼</h2>
                    
                    <div class="bg-green-50 border-2 border-green-200 rounded-lg p-6 mb-6">
                        <p class="text-lg text-green-800 mb-2">Your order number is | æ‚¨çš„è®¢å•å·æ˜¯ï¼š</p>
                        <p id="orderNumber" class="text-2xl sm:text-3xl font-bold text-green-900"></p>
                        <p class="text-sm text-green-600 mt-2">Please save this order number for future reference | è¯·ä¿å­˜æ­¤è®¢å•å·ï¼Œä»¥ä¾¿åç»­æŸ¥è¯¢</p>
                    </div>

                    <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-6 mb-6 text-left">
                        <h3 class="font-bold text-blue-900 mb-3">Booking Details | é¢„çº¦è¯¦æƒ…ï¼š</h3>
                        <div id="bookingDetails" class="space-y-2 text-blue-800">
                            <!-- é¢„çº¦è¯¦æƒ… -->
                        </div>
                    </div>

                    <div class="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-6 mb-6 text-left">
                        <h3 class="font-bold text-yellow-900 mb-3">ğŸ“‹ Important Notes | æ³¨æ„äº‹é¡¹ï¼š</h3>
                        <div id="noticeText" class="text-yellow-800 whitespace-pre-line">
Please note:
â€¢ Please ensure the appointment time is accurate
â€¢ For cancellations or modifications, please contact us 24 hours in advance
â€¢ Please prepare relevant documents on the inspection day
â€¢ If you have special requirements, please specify in the remarks

è¯·æ³¨æ„ï¼š
â€¢ è¯·ç¡®ä¿é¢„çº¦æ—¶é—´å‡†ç¡®æ— è¯¯
â€¢ å¦‚éœ€å–æ¶ˆæˆ–ä¿®æ”¹ï¼Œè¯·æå‰24å°æ—¶è”ç³»
â€¢ æ£€æŸ¥å½“å¤©è¯·å‡†å¤‡å¥½ç›¸å…³æ–‡ä»¶
â€¢ å¦‚æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œè¯·åœ¨å¤‡æ³¨ä¸­è¯´æ˜
                        </div>
                    </div>

                    <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-6 mb-6 text-left">
                        <h3 class="font-bold text-blue-900 mb-3">ğŸ“¢ Important Notice | é‡è¦æç¤ºï¼š</h3>
                        <div id="afterSubmitNotice" class="text-blue-800 whitespace-pre-line">
We will confirm your appointment details within 24 hours.
If you have any questions, please contact us anytime.
Thank you for your trust!

æˆ‘ä»¬ä¼šåœ¨24å°æ—¶å†…ä¸æ‚¨ç¡®è®¤é¢„çº¦è¯¦æƒ…ã€‚
å¦‚æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·éšæ—¶è”ç³»æˆ‘ä»¬ã€‚
è°¢è°¢æ‚¨çš„ä¿¡ä»»ï¼
                        </div>
                    </div>

                    <div class="text-center">
                        <button id="resetBtn" class="btn-secondary text-white px-6 sm:px-8 py-3 rounded-lg font-semibold">
                            Book Other Services<br>é¢„çº¦å…¶ä»–æœåŠ¡
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç®¡ç†å‘˜è§†å›¾ -->
        <div id="adminView" style="display: none;">
            <!-- æ—¥å†è§†å›¾ -->
            <div class="glass-effect rounded-2xl p-6 shadow-xl card-hover mb-6">
                <div class="flex flex-col sm:flex-row justify-between items-center mb-4">
                    <h3 class="text-xl font-bold gradient-text">ğŸ“… Appointment Calendar | é¢„çº¦æ—¥å†</h3>
                    <div class="flex items-center space-x-2 mt-4 sm:mt-0">
                        <button id="prevMonth" class="btn-primary text-white px-3 py-2 rounded-lg text-sm">â€¹</button>
                        <span id="currentMonthYear" class="text-lg font-semibold mx-4 text-gray-700"></span>
                        <button id="nextMonth" class="btn-primary text-white px-3 py-2 rounded-lg text-sm">â€º</button>
                    </div>
                </div>
                <div id="calendarGrid" class="grid grid-cols-7 gap-2">
                    <!-- æ—¥å†ç½‘æ ¼ -->
                </div>
                <div class="mt-4 text-sm text-gray-600">
                    <p>Click on a date to filter orders for that day | ç‚¹å‡»æ—¥æœŸå¯ç­›é€‰å½“å¤©è®¢å•</p>
                    <p>Blue dots indicate confirmed appointments | è“ç‚¹è¡¨ç¤ºå·²ç¡®è®¤çš„é¢„çº¦</p>
                </div>
            </div>

            <!-- åå°ç®¡ç†æ ‡ç­¾é¡µ -->
            <div class="flex space-x-1 bg-gray-100 p-1 rounded-lg mb-6">
                <button id="ordersTabBtn" class="flex-1 py-3 px-4 rounded-md font-medium transition-all nav-active">
                    ğŸ“‹ Order Management | è®¢å•ç®¡ç†
                </button>
                <button id="settingsTabBtn" class="flex-1 py-3 px-4 rounded-md font-medium transition-all nav-inactive">
                    âš™ï¸ System Settings | ç³»ç»Ÿè®¾ç½®
                </button>
            </div>

            <!-- è®¢å•ç®¡ç† -->
            <div id="ordersTab" class="glass-effect rounded-2xl p-6 shadow-xl card-hover">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold gradient-text">Order Management | è®¢å•ç®¡ç†</h3>
                    <button id="showAllOrdersBtn" class="btn-secondary text-white px-4 py-2 rounded-lg text-sm" style="display: none;">
                        Show All Orders | æ˜¾ç¤ºæ‰€æœ‰è®¢å•
                    </button>
                </div>
                <div id="ordersList">
                    <p class="text-center text-gray-500 py-8">Loading orders... | æ­£åœ¨åŠ è½½è®¢å•æ•°æ®...</p>
                </div>
            </div>

            <!-- ç³»ç»Ÿè®¾ç½® -->
            <div id="settingsTab" style="display: none;" class="glass-effect rounded-2xl p-6 shadow-xl card-hover">
                <h3 class="text-xl font-bold gradient-text mb-6">System Settings | ç³»ç»Ÿè®¾ç½®</h3>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Customer Welcome Message | å®¢æˆ·ç«¯æ¬¢è¿ä¿¡æ¯
                        </label>
                        <textarea id="welcomeMessageInput" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" rows="3">Welcome to our property inspection booking system! We provide professional and caring property inspection services.</textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Important Notes After Submission | æäº¤åæ³¨æ„äº‹é¡¹
                        </label>
                        <textarea id="noticeMessageInput" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" rows="6">Please note:
â€¢ Please ensure the appointment time is accurate
â€¢ For cancellations or modifications, please contact us 24 hours in advance
â€¢ Please prepare relevant documents on the inspection day
â€¢ If you have special requirements, please specify in the remarks

è¯·æ³¨æ„ï¼š
â€¢ è¯·ç¡®ä¿é¢„çº¦æ—¶é—´å‡†ç¡®æ— è¯¯
â€¢ å¦‚éœ€å–æ¶ˆæˆ–ä¿®æ”¹ï¼Œè¯·æå‰24å°æ—¶è”ç³»
â€¢ æ£€æŸ¥å½“å¤©è¯·å‡†å¤‡å¥½ç›¸å…³æ–‡ä»¶
â€¢ å¦‚æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œè¯·åœ¨å¤‡æ³¨ä¸­è¯´æ˜</textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Important Notice After Submission | æäº¤åé‡è¦æç¤º
                        </label>
                        <textarea id="afterSubmitNoticeInput" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" rows="4">We will confirm your appointment details within 24 hours.
If you have any questions, please contact us anytime.
Thank you for your trust!

æˆ‘ä»¬ä¼šåœ¨24å°æ—¶å†…ä¸æ‚¨ç¡®è®¤é¢„çº¦è¯¦æƒ…ã€‚
å¦‚æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·éšæ—¶è”ç³»æˆ‘ä»¬ã€‚
è°¢è°¢æ‚¨çš„ä¿¡ä»»ï¼</textarea>